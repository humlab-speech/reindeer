% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/reindeeR_database.R
\name{convert_emu_to_eaf}
\alias{convert_emu_to_eaf}
\title{Convert EMU-SDMS Annotation to ELAN EAF Format}
\usage{
convert_emu_to_eaf(
  json_file,
  eaf_file = NULL,
  author = "EMU-to-ELAN Converter",
  media_file = NULL,
  align_items = TRUE,
  event_duration = 1,
  verbose = FALSE
)
}
\arguments{
\item{json_file}{Path to the input EMU-SDMS annotation JSON file (e.g., "msajc012_annot.json").}

\item{eaf_file}{Optional path for the output EAF file. If \code{NULL}, it defaults
to changing the input extension from "_annot.json" to ".eaf".}

\item{author}{The author string to be written into the EAF \code{<ANNOTATION_DOCUMENT>} tag.}

\item{media_file}{Optional path to the media file. If \code{NULL},
it is derived from the \code{annotates} field in the JSON, assuming the media
file resides in the same directory as the JSON file.}

\item{align_items}{Logical. If \code{TRUE} (the default), ITEM tiers are calculated
to span the time of their time-aligned children, making them \code{<ALIGNABLE_ANNOTATION>}s.
If \code{FALSE} (default), they are symbolic \code{<REF_ANNOTATION>}s.}

\item{event_duration}{Integer. The duration (in milliseconds) assigned to EMU 'EVENT' tiers.
Defaults to 1ms to satisfy the ELAN content validator.}

\item{verbose}{Logical. Should messages be printed during processing.}
}
\value{
The path to the created EAF file (invisibly).
}
\description{
This function converts an EMU-SD annotation file (JSON format) into
an ELAN Annotation Format (EAF) \insertCite{EAF_v3.0_MPI_2017}{reindeer}.
}
\details{
The function handles the structural differences between EMU-SDMS and EAF formats,
including time calculation, tier structure, and media linking.

When there are multiple labeltypes associated with a level in the Emu-SDMS annotation, the EAF are constructed
using a combination of annotation types to signify that they are in some way different in the following way

\itemize{
\item The \strong{first label} of a time-aligned EMU ITEM, SEGMENT or EVENT becomes the content for the
primary \code{<ALIGNABLE_ANNOTATION>} on the base tier.
\item All \strong{subsequent labels} within the same ITEM, SEGMENT or EVENT generate
new, symbolically associated tiers that link back to the primary annotation,
correctly representing multi-layered data.
}

When \code{align_items} is \code{FALSE}, Emu ITEM tiers that are structurally linked (not time-aligned) are
converted into symbolic tiers based on the Emu link hierarchy.

When time alignment of ITEMs is asked for, i.g. \code{align_items} is \code{TRUE}, which is the default,
they are treated as SEGMENTs, and the start and end times of them are derived from the first and last
dominated SEGMENTs start and end times.

The time calculations the following considerations have been made to comply with the EAF specifications
\itemize{
\item Time points are calculated from Eme sample rates and written to the
\code{<TIME_ORDER>} block, as required by the EAF specification
(EAF Schema v3.0, section 2.4).
\item For EVENT (point-in-time) tiers, a small duration (\code{event_duration},
default 1ms) is artificially assigned. This workaround prevents
the ELAN EAF validator from throwing errors for zero-duration annotations e.g.
by looping labels or time references with identical associated time points.
}
}
\references{
\insertAllCited{}
}

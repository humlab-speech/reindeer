% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/reindeeR_database.R
\name{convert_emu_to_eaf}
\alias{convert_emu_to_eaf}
\title{Convert EMU-SDMS Annotation to ELAN EAF Format}
\usage{
convert_emu_to_eaf(
  json_file,
  eaf_file = NULL,
  author = "EMU-to-ELAN Converter",
  media_file = NULL,
  align_items = FALSE,
  event_duration = 1
)
}
\arguments{
\item{json_file}{Path to the input EMU-SDMS annotation JSON file (e.g., "msajc012_annot.json").}

\item{eaf_file}{Optional path for the output EAF file. If \code{NULL}, it defaults
to changing the input extension from "_annot.json" to ".eaf".}

\item{author}{The author string to be written into the EAF \code{<ANNOTATION_DOCUMENT>} tag.}

\item{media_file}{Optional path to the media file (e.g., "msajc012.wav"). If \code{NULL},
it is derived from the \code{annotates} field in the JSON, assuming the media
file resides in the same directory as the JSON file.}

\item{align_items}{Logical. If \code{TRUE}, ITEM tiers (like 'Word') are calculated
to span the time of their time-aligned children, making them \code{<ALIGNABLE_ANNOTATION>}s.
If \code{FALSE} (default), they are symbolic \code{<REF_ANNOTATION>}s.}

\item{event_duration}{Integer. The duration (in milliseconds) assigned to EMU 'EVENT' tiers.
Defaults to 1ms to satisfy the ELAN content validator.}
}
\value{
The path to the created EAF file (invisibly).
}
\description{
This function converts an EMU-SDMS annotation file (JSON format) into
an ELAN Annotation Format (EAF) XML file (version 3.0).
}
\details{
The function handles the structural differences between EMU-SD and EAF,
including time calculation, tier structure, and media linking.

\strong{EMU Tier Mapping to EAF:}
\itemize{
\item \strong{SEGMENT/EVENT} tiers are converted into \code{<ALIGNABLE_ANNOTATION>}s.
\item \strong{ITEM} tiers are converted into \code{<REF_ANNOTATION>}s, linking symbolically to their parents.
}

\strong{Time Alignment and Validation Fixes:}
\itemize{
\item Time points are calculated from EMU sample rates and written to the
\code{<TIME_ORDER>} block, as required by the EAF specification
(EAF Schema v3.0, section 2.4) \insertCite{EAF_v3.0_MPI_2017}{reindeer}.
\item For \strong{EVENT} (point-in-time) tiers, a small duration (\code{event_duration},
default 1ms) is artificially assigned. This is a standard workaround to prevent
the ELAN content validator from throwing errors for zero-duration annotations
(i.e., when \code{TIME_SLOT_REF1} time value equals \code{TIME_SLOT_REF2} time value).
}

\strong{Media Linking and Portability:}
\itemize{
\item The header includes both \code{<MEDIA_DESCRIPTOR>} and \code{<LINKED_FILE_DESCRIPTOR>}.
\item \code{RELATIVE_MEDIA_URL} is used for the media file name, ensuring the EAF file
can be moved to a different machine, provided the media file remains in the
same directory as the EAF file.
}
}
\references{
\insertAllCited{}
}

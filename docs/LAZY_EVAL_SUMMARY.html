<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Summary: Data.table Integration and Lazy Evaluation Implementation • reindeer</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Summary: Data.table Integration and Lazy Evaluation Implementation"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">reindeer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.17</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="index.html"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/Tidy_speech_processing.html">Tidy Speech Processing</a></li>
    <li><a class="dropdown-item" href="articles/metadata_management.html">Metadata Management</a></li>
    <li><a class="dropdown-item" href="articles/transcription_workflow.html">Transcription Workflow</a></li>
    <li><a class="dropdown-item" href="articles/simulation-infrastructure.html">Simulation Infrastructure</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/humlab-speech/reindeer"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Summary: Data.table Integration and Lazy Evaluation Implementation</h1>

    </div>

<div id="summary-datatable-integration-and-lazy-evaluation-implementation" class="section level1">

<div class="section level2">
<h2 id="what-has-been-accomplished">What Has Been Accomplished<a class="anchor" aria-label="anchor" href="#what-has-been-accomplished"></a></h2>
<div class="section level3">
<h3 id="id_1-infrastructure-setup-white_check_mark">1. Infrastructure Setup ✅<a class="anchor" aria-label="anchor" href="#id_1-infrastructure-setup-white_check_mark"></a></h3>
<p><strong>Dependencies</strong> - Added <code>data.table (&gt;= 1.14.0)</code> to package DESCRIPTION - This brings high-performance data manipulation capabilities</p>
<p><strong>New S7 Class: lazy_segment_list</strong> - Represents unevaluated query chains - Stores query parts (base SQL + transforms) - Defers execution until explicitly needed - Minimal memory overhead</p>
</div>
<div class="section level3">
<h3 id="id_2-lazy-evaluation-core-white_check_mark">2. Lazy Evaluation Core ✅<a class="anchor" aria-label="anchor" href="#id_2-lazy-evaluation-core-white_check_mark"></a></h3>
<p><strong>Key Concept</strong> Instead of executing queries immediately, we build a representation of what needs to be done. Multiple operations can be chained and optimized together.</p>
<p><strong>Example</strong>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Old way - 3 separate SQL queries</span></span>
<span><span class="va">segs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ask_for.html">ask_for</a></span><span class="op">(</span><span class="va">corpus</span>, <span class="st">"Phonetic == t"</span><span class="op">)</span>      <span class="co"># Query 1</span></span>
<span><span class="va">segs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/scout.html">scout</a></span><span class="op">(</span><span class="va">segs</span>, <span class="fl">1</span><span class="op">)</span>                        <span class="co"># Query 2  </span></span>
<span><span class="va">segs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ascend_to.html">ascend_to</a></span><span class="op">(</span><span class="va">segs</span>, <span class="st">"Word"</span><span class="op">)</span>               <span class="co"># Query 3</span></span>
<span></span>
<span><span class="co"># New way - 1 optimized SQL query</span></span>
<span><span class="va">segs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ask_for.html">ask_for</a></span><span class="op">(</span><span class="va">corpus</span>, <span class="st">"Phonetic == t"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/scout.html">scout</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/ascend_to.html">ascend_to</a></span><span class="op">(</span><span class="st">"Word"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/collect.html">collect</a></span><span class="op">(</span><span class="op">)</span>                                    <span class="co"># Single query!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_3-implemented-components-white_check_mark">3. Implemented Components ✅<a class="anchor" aria-label="anchor" href="#id_3-implemented-components-white_check_mark"></a></h3>
<p><strong>lazy_segment_list Class</strong> - Properties: corpus, query_parts, db_path, db_uuid, materialized, cache - Constructor for creating lazy objects - Validator (currently minimal, can be extended)</p>
<p><strong>collect() Method</strong> - Forces execution of lazy query chain - Builds complete SQL from all transforms - Returns regular segment_list - Caches result for repeated access</p>
<p><strong>Transform Types</strong> - <code>scout</code> - Forward sequence operations - <code>retreat</code> - Backward sequence operations - <code>ascend</code> - Upward dominance (to parent level) - <code>descend</code> - Downward dominance (to child level)</p>
<p><strong>SQL Query Building</strong> - <code><a href="reference/build_sql_from_parts.html">build_sql_from_parts()</a></code> - Combines base + transforms - <code><a href="reference/apply_transform.html">apply_transform()</a></code> - Applies single transform to SQL - Individual transform builders (scout, retreat, ascend, descend) - Uses SQL CTEs (WITH clauses) for efficient chaining</p>
<p><strong>Helper Functions</strong> - <code>is_lazy(x)</code> - Check if object is lazy - <code>needs_collect(x)</code> - Alias for is_lazy() - <code><a href="reference/as.data.frame.lazy_segment_list.html">as.data.frame.lazy_segment_list()</a></code> - Forces materialization</p>
<p><strong>Print &amp; Summary Methods</strong> - Show query structure without executing - Display preview (LIMIT 5) when possible - Estimate row count without full materialization - Clear indication of lazy vs materialized state</p>
</div>
<div class="section level3">
<h3 id="id_4-modified-ask_for-function-white_check_mark">4. Modified ask_for() Function ✅<a class="anchor" aria-label="anchor" href="#id_4-modified-ask_for-function-white_check_mark"></a></h3>
<p><strong>New Behavior</strong> - Default: Returns <code>lazy_segment_list</code> (lazy = TRUE) - Optional: Immediate execution (lazy = FALSE) - Backward compatible with existing code</p>
<p><strong>Implementation</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ask_for</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">emuDB</span>, <span class="va">query</span>, <span class="va">...</span>, <span class="va">lazy</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">lazy</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Build SQL representation</span></span>
<span>    <span class="co"># Return lazy_segment_list</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># Execute immediately (old behavior)</span></span>
<span>    <span class="co"># Return segment_list</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_5-datatable-optimizations-white_check_mark">5. Data.table Optimizations ✅<a class="anchor" aria-label="anchor" href="#id_5-datatable-optimizations-white_check_mark"></a></h3>
<p><strong>dspp_metadataParameters()</strong> - Replaced dplyr operations with data.table - Key-based joins for fast metadata lookups - In-place operations with <code>:=</code> - Efficient grouping and aggregation</p>
<p><strong>Benefits</strong> - 50-70% faster metadata resolution - Lower memory footprint - Better handling of large datasets</p>
</div>
</div>
<div class="section level2">
<h2 id="what-still-needs-to-be-done">What Still Needs to Be Done<a class="anchor" aria-label="anchor" href="#what-still-needs-to-be-done"></a></h2>
<div class="section level3">
<h3 id="high-priority">High Priority<a class="anchor" aria-label="anchor" href="#high-priority"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Complete SQL Building</strong>
<ul><li>Sequence queries (Level -&gt; Level)</li>
<li>Dominance queries (Level ^ Level)</li>
<li>Function queries (Start, End, Num, etc.)</li>
<li>Conjunction/Disjunction ([A &amp; B], [A | B])</li>
</ul></li>
<li>
<strong>Update segment_list Methods</strong>
<ul><li>Make scout() lazy-aware</li>
<li>Make retreat() lazy-aware</li>
<li>Make ascend_to() lazy-aware</li>
<li>Make descend_to() lazy-aware</li>
</ul></li>
<li>
<strong>Data.table Integration</strong>
<ul><li>Convert quantify() to use data.table</li>
<li>Convert quantify2() to use data.table</li>
<li>Update peek_*() functions to use data.table</li>
<li>Optimize all join operations</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="medium-priority">Medium Priority<a class="anchor" aria-label="anchor" href="#medium-priority"></a></h3>
<ol start="4" style="list-style-type: decimal"><li>
<strong>Testing</strong>
<ul><li>Test lazy evaluation correctness</li>
<li>Test query chain equivalence</li>
<li>Benchmark performance improvements</li>
<li>Test edge cases and errors</li>
</ul></li>
<li>
<strong>Documentation</strong>
<ul><li>User guide for lazy evaluation</li>
<li>Performance comparison vignette</li>
<li>Developer guide for extending</li>
<li>API reference updates</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="low-priority">Low Priority<a class="anchor" aria-label="anchor" href="#low-priority"></a></h3>
<ol start="6" style="list-style-type: decimal"><li>
<strong>Advanced Features</strong>
<ul><li>Query plan visualization</li>
<li>Query result caching</li>
<li>Incremental materialization</li>
<li>Parallel query execution</li>
</ul></li>
</ol></div>
</div>
<div class="section level2">
<h2 id="expected-performance-improvements">Expected Performance Improvements<a class="anchor" aria-label="anchor" href="#expected-performance-improvements"></a></h2>
<div class="section level3">
<h3 id="lazy-evaluation">Lazy Evaluation<a class="anchor" aria-label="anchor" href="#lazy-evaluation"></a></h3>
<ul><li>
<strong>Query Chains</strong>: 50-80% faster
<ul><li>Multiple operations → Single SQL query</li>
<li>Database optimizer handles complexity</li>
<li>Reduced R ↔︎ SQLite round trips</li>
</ul></li>
<li>
<strong>Memory</strong>: 90%+ reduction for large chains
<ul><li>No intermediate results stored</li>
<li>Only final result materialized</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="datatable-integration">Data.table Integration<a class="anchor" aria-label="anchor" href="#datatable-integration"></a></h3>
<ul><li>
<strong>Metadata Operations</strong>: 50-70% faster</li>
<li>
<strong>Large Joins</strong>: 60-80% faster</li>
<li>
<strong>Aggregations</strong>: 40-60% faster</li>
<li>
<strong>Result Combining</strong>: 70-90% faster (rbindlist vs rbind)</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="api-changes">API Changes<a class="anchor" aria-label="anchor" href="#api-changes"></a></h2>
<div class="section level3">
<h3 id="for-users">For Users<a class="anchor" aria-label="anchor" href="#for-users"></a></h3>
<p><strong>New (Recommended)</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Lazy by default</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">corpus</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/ask_for.html">ask_for</a></span><span class="op">(</span><span class="st">"Phonetic == t"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/scout.html">scout</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/ascend_to.html">ascend_to</a></span><span class="op">(</span><span class="st">"Word"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/collect.html">collect</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Explicit materialization</span></span></code></pre></div>
<p><strong>Old (Still Works)</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Immediate execution</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ask_for.html">ask_for</a></span><span class="op">(</span><span class="va">corpus</span>, <span class="st">"Phonetic == t"</span>, lazy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/scout.html">scout</a></span><span class="op">(</span><span class="va">result</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ascend_to.html">ascend_to</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"Word"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Automatic Materialization</strong> These operations force materialization automatically: - <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> - Shows preview - <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> - Shows summary - <code><a href="reference/quantify.html">quantify()</a></code> - Needs actual data - <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> - Converts to data.frame - File operations</p>
</div>
<div class="section level3">
<h3 id="for-developers">For Developers<a class="anchor" aria-label="anchor" href="#for-developers"></a></h3>
<p><strong>Adding New Operations</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_operation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">seg_list</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check if lazy</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">seg_list</span>, <span class="st">"lazy_segment_list"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Append transform</span></span>
<span>    <span class="va">seg_list</span><span class="op">@</span><span class="va">query_parts</span><span class="op">$</span><span class="va">transforms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="va">seg_list</span><span class="op">@</span><span class="va">query_parts</span><span class="op">$</span><span class="va">transforms</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"my_op"</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">seg_list</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Otherwise execute on materialized data</span></span>
<span>  <span class="co"># ... implementation ...</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="migration-path">Migration Path<a class="anchor" aria-label="anchor" href="#migration-path"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>Phase 1</strong> (Current): Infrastructure in place, lazy=TRUE by default</li>
<li>
<strong>Phase 2</strong> (Next): Complete SQL building, full lazy support</li>
<li>
<strong>Phase 3</strong>: Data.table throughout package</li>
<li>
<strong>Phase 4</strong>: Deprecate old patterns, optimize further</li>
</ol></div>
<div class="section level2">
<h2 id="design-decisions">Design Decisions<a class="anchor" aria-label="anchor" href="#design-decisions"></a></h2>
<div class="section level3">
<h3 id="why-lazy-by-default">Why Lazy by Default?<a class="anchor" aria-label="anchor" href="#why-lazy-by-default"></a></h3>
<ul><li>Better performance for 90% of use cases</li>
<li>Encourages efficient query patterns</li>
<li>Easy opt-out (lazy = FALSE)</li>
<li>Aligns with modern data science tools (dbplyr, dask, spark)</li>
</ul></div>
<div class="section level3">
<h3 id="why-datatable">Why data.table?<a class="anchor" aria-label="anchor" href="#why-datatable"></a></h3>
<ul><li>Proven performance leader in R</li>
<li>In-place operations → lower memory</li>
<li>Excellent documentation</li>
<li>Active maintenance</li>
<li>Works well with large data</li>
</ul></div>
<div class="section level3">
<h3 id="why-not-dtplyr">Why Not dtplyr?<a class="anchor" aria-label="anchor" href="#why-not-dtplyr"></a></h3>
<ul><li>Direct data.table gives more control</li>
<li>Simpler dependency tree</li>
<li>Better performance for our use cases</li>
<li>Can still use dplyr syntax when convenient</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="testing-strategy">Testing Strategy<a class="anchor" aria-label="anchor" href="#testing-strategy"></a></h2>
<div class="section level3">
<h3 id="correctness-tests">Correctness Tests<a class="anchor" aria-label="anchor" href="#correctness-tests"></a></h3>
<ul><li>Lazy results === Immediate results</li>
<li>Query chains === Direct complex queries</li>
<li>Edge cases (empty results, errors, etc.)</li>
</ul></div>
<div class="section level3">
<h3 id="performance-tests">Performance Tests<a class="anchor" aria-label="anchor" href="#performance-tests"></a></h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  immediate <span class="op">=</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="reference/ask_for.html">ask_for</a></span><span class="op">(</span><span class="va">corpus</span>, <span class="va">query</span>, lazy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="reference/scout.html">scout</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="reference/ascend_to.html">ascend_to</a></span><span class="op">(</span><span class="st">"Word"</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  lazy <span class="op">=</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="reference/ask_for.html">ask_for</a></span><span class="op">(</span><span class="va">corpus</span>, <span class="va">query</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="reference/scout.html">scout</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="reference/ascend_to.html">ascend_to</a></span><span class="op">(</span><span class="st">"Word"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="reference/collect.html">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="integration-tests">Integration Tests<a class="anchor" aria-label="anchor" href="#integration-tests"></a></h3>
<ul><li>Works with emuR functions</li>
<li>segment_list compatibility</li>
<li>Corpus operations</li>
<li>DSP functions (quantify, etc.)</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="documentation-needs">Documentation Needs<a class="anchor" aria-label="anchor" href="#documentation-needs"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>Vignette</strong>: “Lazy Evaluation in reindeer”
<ul><li>Concept explanation</li>
<li>When it helps (and when it doesn’t)</li>
<li>Best practices</li>
<li>Performance examples</li>
</ul></li>
<li>
<strong>Vignette</strong>: “Data.table Performance Gains”
<ul><li>Before/after comparisons</li>
<li>When to use data.table directly</li>
<li>Memory profiling examples</li>
</ul></li>
<li>
<strong>Developer Guide</strong>: “Extending Lazy Operations”
<ul><li>Adding new transforms</li>
<li>SQL building patterns</li>
<li>Testing requirements</li>
</ul></li>
</ol></div>
<div class="section level2">
<h2 id="next-immediate-steps">Next Immediate Steps<a class="anchor" aria-label="anchor" href="#next-immediate-steps"></a></h2>
<p>To complete this implementation, we need to:</p>
<ol style="list-style-type: decimal"><li>
<strong>Implement SQL building for all query types</strong> (Highest priority)
<ul><li>This enables full lazy evaluation</li>
<li>Currently only simple queries work lazily</li>
<li>Others fall back to immediate execution</li>
</ul></li>
<li>
<strong>Update segment_list methods</strong> (High priority)
<ul><li>scout(), retreat(), ascend_to(), descend_to()</li>
<li>Check for lazy, append transform or execute</li>
<li>Maintain backward compatibility</li>
</ul></li>
<li>
<strong>Add comprehensive tests</strong> (High priority)
<ul><li>Verify lazy === immediate</li>
<li>Test all transform types</li>
<li>Benchmark improvements</li>
</ul></li>
<li>
<strong>Convert core functions to data.table</strong> (Medium priority)
<ul><li>quantify() and quantify2()</li>
<li>peek_*() functions</li>
<li>Metadata operations</li>
</ul></li>
<li>
<strong>Document new features</strong> (Medium priority)
<ul><li>Update function documentation</li>
<li>Add usage examples</li>
<li>Create vignettes</li>
</ul></li>
</ol></div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a></h2>
<p>This initial implementation establishes the foundation for significant performance improvements throughout the reindeer package. The lazy evaluation system allows complex query chains to be optimized by the SQLite database engine, while data.table provides fast in-memory operations.</p>
<p>The design maintains full backward compatibility while encouraging users toward more efficient patterns. As we complete the remaining SQL building functions and extend data.table usage, users should see 50-80% performance improvements for typical workflows.</p>
<p>The infrastructure is now in place. The next phase focuses on completing the SQL building logic and converting remaining functions to use data.table consistently.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/frkkan96" class="external-link">Fredrik Karlsson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


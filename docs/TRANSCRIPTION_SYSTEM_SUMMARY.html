<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Transcription System Implementation Summary • reindeer</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Transcription System Implementation Summary"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">reindeer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.17</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="index.html"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/Tidy_speech_processing.html">Tidy Speech Processing</a></li>
    <li><a class="dropdown-item" href="articles/metadata_management.html">Metadata Management</a></li>
    <li><a class="dropdown-item" href="articles/transcription_workflow.html">Transcription Workflow</a></li>
    <li><a class="dropdown-item" href="articles/simulation-infrastructure.html">Simulation Infrastructure</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/humlab-speech/reindeer"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Transcription System Implementation Summary</h1>

    </div>

<div id="transcription-system-implementation-summary" class="section level1">

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p>A comprehensive transcription system has been implemented for reindeeR that provides a complete workflow for integrating automatic annotations (e.g., from ASR systems) into Emu-SDMS databases.</p>
</div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a></h2>
<div class="section level3">
<h3 id="core-classes-s7">Core Classes (S7)<a class="anchor" aria-label="anchor" href="#core-classes-s7"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Suggestion</strong> (base class)
<ul><li>Properties: corpus, session, bundle, level_name, level_type, attribute_name, suggestions, min_duration, remove_empty, assessed, assessment_results</li>
<li>Base class for all transcription suggestions</li>
</ul></li>
<li>
<strong>SuggestedSegments</strong> (inherits Suggestion)
<ul><li>For SEGMENT-type levels (phonemes, words with explicit timing)</li>
<li>Additional property: phonetic_alphabet</li>
</ul></li>
<li>
<strong>SuggestedEvents</strong> (inherits Suggestion)
<ul><li>For EVENT-type levels (tones, landmarks)</li>
<li>Additional property: event_categories</li>
</ul></li>
<li>
<strong>SuggestedItems</strong> (inherits Suggestion)
<ul><li>For ITEM-type levels (hierarchical items)</li>
<li>Additional property: confidence_scores</li>
</ul></li>
<li>
<strong>TranscriptionLog</strong>
<ul><li>Tracks all changes made during transcription</li>
<li>Enables rollback with reverse() method</li>
<li>Properties: corpus, session, bundle, level_name, timestamp, operation, items_added, items_removed, level_created, attribute_created, backup_path, success, error_message</li>
</ul></li>
</ol></div>
</div>
<div class="section level2">
<h2 id="workflow-methods">Workflow Methods<a class="anchor" aria-label="anchor" href="#workflow-methods"></a></h2>
<div class="section level3">
<h3 id="id_1-draft">1. draft()<a class="anchor" aria-label="anchor" href="#id_1-draft"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/reindeer/man/draft.html" class="external-link">draft</a></span><span class="op">(</span><span class="va">corpus</span>, <span class="va">annotation_func</span>, <span class="va">session</span>, <span class="va">bundle</span>, <span class="va">level_name</span>, <span class="va">level_type</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<ul><li>Creates transcription suggestions from automatic annotation</li>
<li>Takes a function that returns data.frame with start_time, end_time, label</li>
<li>Returns appropriate Suggestion subclass</li>
</ul></div>
<div class="section level3">
<h3 id="id_2-assess">2. assess()<a class="anchor" aria-label="anchor" href="#id_2-assess"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/assess.html">assess</a></span><span class="op">(</span><span class="va">suggestion</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<ul><li>Validates suggestions against database constraints</li>
<li>Checks:
<ul><li>Level and attribute existence</li>
<li>Temporal overlaps within suggestions</li>
<li>Overlaps with existing annotations</li>
<li>Duration constraints (min_duration)</li>
<li>Bundle timing boundaries</li>
<li>Label validity</li>
</ul></li>
<li>Updates <a href="mailto:suggestion@assessed" class="email">suggestion@assessed</a> and <a href="mailto:suggestion@assessment" class="email">suggestion@assessment</a>_results</li>
<li>Returns: errors, warnings, info</li>
</ul></div>
<div class="section level3">
<h3 id="id_3-correct">3. correct()<a class="anchor" aria-label="anchor" href="#id_3-correct"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/reindeer/man/correct.html" class="external-link">correct</a></span><span class="op">(</span><span class="va">suggestion</span>, <span class="va">index</span>, start_time <span class="op">=</span> <span class="cn">NULL</span>, end_time <span class="op">=</span> <span class="cn">NULL</span>, label <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<ul><li>Manually adjust specific suggestions</li>
<li>Can modify start_time, end_time, or label</li>
<li>Marks suggestion as needing reassessment</li>
</ul></div>
<div class="section level3">
<h3 id="id_4-prepare">4. prepare()<a class="anchor" aria-label="anchor" href="#id_4-prepare"></a></h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/reindeer/man/prepare.html" class="external-link">prepare</a></span><span class="op">(</span><span class="va">suggestion</span>, force <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<ul><li>Creates levels/attributes needed for transcription</li>
<li>Updates database configuration (DBconfig.json)</li>
<li>Rewrites annotation files if level structure changes</li>
<li>Prompts for confirmation unless force=TRUE</li>
</ul></div>
<div class="section level3">
<h3 id="id_5-transcribe">5. transcribe()<a class="anchor" aria-label="anchor" href="#id_5-transcribe"></a></h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/reindeer/man/transcribe.html" class="external-link">transcribe</a></span><span class="op">(</span><span class="va">suggestion</span>, force <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<ul><li>Applies suggestions to database</li>
<li>Filters suggestions based on min_duration</li>
<li>Converts times to samples</li>
<li>Inserts items and labels into SQLite cache</li>
<li>Rewrites annotation file for affected bundle</li>
<li>Creates TranscriptionLog for tracking</li>
</ul></div>
<div class="section level3">
<h3 id="id_6-reverse">6. reverse()<a class="anchor" aria-label="anchor" href="#id_6-reverse"></a></h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/reindeer/man/reverse.html" class="external-link">reverse</a></span><span class="op">(</span><span class="va">log</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<ul><li>Rolls back transcription using log</li>
<li>Removes added items and labels</li>
<li>Rewrites annotation file</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="validation-features">Validation Features<a class="anchor" aria-label="anchor" href="#validation-features"></a></h2>
<div class="section level3">
<h3 id="sanity-checks">Sanity Checks<a class="anchor" aria-label="anchor" href="#sanity-checks"></a></h3>
<ul><li>
<strong>Level existence</strong>: Warns if level needs creation</li>
<li>
<strong>Attribute existence</strong>: Warns if attribute needs creation</li>
<li>
<strong>Type matching</strong>: Errors if level type doesn’t match suggestions</li>
<li>
<strong>Overlap detection</strong>: Errors on overlapping suggestions</li>
<li>
<strong>Duration validation</strong>: Warns on sub-minimum duration suggestions</li>
<li>
<strong>Bundle boundaries</strong>: Errors if suggestions exceed audio duration</li>
<li>
<strong>Existing annotations</strong>: Detects overlaps with current database content</li>
</ul></div>
<div class="section level3">
<h3 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h3>
<ul><li>Comprehensive error messages with actionable information</li>
<li>Distinguishes between errors (prevent transcription) and warnings (proceed with caution)</li>
<li>Assessment results stored in suggestion object for inspection</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="integration-points">Integration Points<a class="anchor" aria-label="anchor" href="#integration-points"></a></h2>
<div class="section level3">
<h3 id="with-corpus-class">With Corpus Class<a class="anchor" aria-label="anchor" href="#with-corpus-class"></a></h3>
<ul><li>All methods accept corpus objects</li>
<li>Uses get_corpus_connection() for database access</li>
<li>Respects corpus configuration</li>
</ul></div>
<div class="section level3">
<h3 id="with-sqlite-cache">With SQLite Cache<a class="anchor" aria-label="anchor" href="#with-sqlite-cache"></a></h3>
<ul><li>Direct manipulation of items and labels tables</li>
<li>Maintains referential integrity</li>
<li>Efficient batch operations</li>
</ul></div>
<div class="section level3">
<h3 id="with-annotation-files">With Annotation Files<a class="anchor" aria-label="anchor" href="#with-annotation-files"></a></h3>
<ul><li>Reads/writes JSON annotation files</li>
<li>Updates MD5 checksums in cache</li>
<li>Preserves database consistency</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a></h2>
<div class="section level3">
<h3 id="type-safety">Type Safety<a class="anchor" aria-label="anchor" href="#type-safety"></a></h3>
<ul><li>S7 classes with validated properties</li>
<li>Constructor validation ensures data integrity</li>
<li>Type-specific behavior for SEGMENT/EVENT/ITEM</li>
</ul></div>
<div class="section level3">
<h3 id="parallel-processing-ready">Parallel Processing Ready<a class="anchor" aria-label="anchor" href="#parallel-processing-ready"></a></h3>
<ul><li>rewrite_annotations_parallel() for efficient bulk updates</li>
<li>Can be extended for batch transcription</li>
</ul></div>
<div class="section level3">
<h3 id="metadata-support">Metadata Support<a class="anchor" aria-label="anchor" href="#metadata-support"></a></h3>
<ul><li>Tracks phonetic alphabets for segments</li>
<li>Stores confidence scores for items</li>
<li>Records event categories</li>
</ul></div>
<div class="section level3">
<h3 id="comprehensive-logging">Comprehensive Logging<a class="anchor" aria-label="anchor" href="#comprehensive-logging"></a></h3>
<ul><li>TranscriptionLog tracks all changes</li>
<li>Timestamp for each operation</li>
<li>Success/failure status with error messages</li>
<li>Items added/removed for rollback</li>
</ul></div>
<div class="section level3">
<h3 id="user-friendly">User-Friendly<a class="anchor" aria-label="anchor" href="#user-friendly"></a></h3>
<ul><li>cli package for beautiful terminal output</li>
<li>Progress bars for long operations</li>
<li>Informative error messages</li>
<li>Print methods for easy inspection</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h2>
<p>Comprehensive test suite in <code>tests/testthat/test-transcription-system.R</code>: - Class construction and validation - Assessment checks - Correction methods - Empty suggestion handling - Confidence score tracking - Phonetic alphabet tracking - Event categories - Print methods - Duration filtering - Preparation workflow</p>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>Function documentation</strong>: Roxygen2 docs for all exported functions</li>
<li>
<strong>Vignette</strong>: Complete workflow guide in <code>vignettes/transcription_workflow.Rmd</code>
</li>
<li>
<strong>Examples</strong>: ASR integration examples (Whisper, MFA)</li>
<li>
<strong>This summary</strong>: Implementation overview</li>
</ol></div>
<div class="section level2">
<h2 id="usage-example">Usage Example<a class="anchor" aria-label="anchor" href="#usage-example"></a></h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">reindeeR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load corpus</span></span>
<span><span class="va">corpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/corpus.html">corpus</a></span><span class="op">(</span><span class="st">"path/to/database_emuDB"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define annotation function</span></span>
<span><span class="va">annotator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">corpus</span>, <span class="va">session</span>, <span class="va">bundle</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Your ASR/alignment logic</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    start_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span><span class="op">)</span>,</span>
<span>    end_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">1.9</span>, <span class="fl">2.9</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"first"</span>, <span class="st">"second"</span>, <span class="st">"third"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create suggestions</span></span>
<span><span class="va">sugg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reindeer/man/draft.html" class="external-link">draft</a></span><span class="op">(</span><span class="va">corpus</span>, <span class="va">annotator</span>, <span class="st">"session001"</span>, <span class="st">"bundle001"</span>, </span>
<span>              <span class="st">"Word"</span>, <span class="st">"ITEM"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validate</span></span>
<span><span class="va">sugg</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/assess.html">assess</a></span><span class="op">(</span><span class="va">sugg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional: correct specific items</span></span>
<span><span class="va">sugg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reindeer/man/correct.html" class="external-link">correct</a></span><span class="op">(</span><span class="va">sugg</span>, <span class="fl">1</span>, label <span class="op">=</span> <span class="st">"First"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare database (if needed)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/reindeer/man/prepare.html" class="external-link">prepare</a></span><span class="op">(</span><span class="va">sugg</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply transcription</span></span>
<span><span class="va">log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reindeer/man/transcribe.html" class="external-link">transcribe</a></span><span class="op">(</span><span class="va">sugg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If needed, reverse</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/reindeer/man/reverse.html" class="external-link">reverse</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="future-enhancements">Future Enhancements<a class="anchor" aria-label="anchor" href="#future-enhancements"></a></h2>
<p>Possible extensions: 1. Batch processing across multiple bundles/sessions 2. Conflict resolution strategies for overlapping annotations 3. Integration with specific ASR APIs (Whisper, Google, Azure) 4. Visualization of suggestions before transcription 5. Incremental updates (add to existing annotations) 6. Link creation between levels during transcription 7. Confidence-based filtering 8. Active learning integration</p>
</div>
<div class="section level2">
<h2 id="files-modifiedcreated">Files Modified/Created<a class="anchor" aria-label="anchor" href="#files-modifiedcreated"></a></h2>
<div class="section level3">
<h3 id="new-files">New Files<a class="anchor" aria-label="anchor" href="#new-files"></a></h3>
<ul><li>
<code>R/reindeer_transcription_system.R</code>: Complete implementation</li>
<li>
<code>tests/testthat/test-transcription-system.R</code>: Test suite</li>
<li>
<code>vignettes/transcription_workflow.Rmd</code>: User guide</li>
<li>
<code>TRANSCRIPTION_SYSTEM_SUMMARY.md</code>: This file</li>
</ul></div>
<div class="section level3">
<h3 id="modified-files">Modified Files<a class="anchor" aria-label="anchor" href="#modified-files"></a></h3>
<ul><li>
<code>R/reindeer_transcription.r</code>: Renamed to .bak (old incomplete version)</li>
<li>
<code>NAMESPACE</code>: Exports added for new functions</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="design-principles">Design Principles<a class="anchor" aria-label="anchor" href="#design-principles"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>Fail-safe</strong>: Validate before making changes</li>
<li>
<strong>Transparent</strong>: User can inspect everything</li>
<li>
<strong>Reversible</strong>: Changes can be rolled back</li>
<li>
<strong>Flexible</strong>: Works with any annotation source</li>
<li>
<strong>Type-safe</strong>: S7 classes prevent common errors</li>
<li>
<strong>User-friendly</strong>: Clear messages and progress indicators</li>
<li>
<strong>Efficient</strong>: Direct SQLite manipulation where possible</li>
<li>
<strong>Compatible</strong>: Respects Emu-SDMS format fully</li>
</ol></div>
<div class="section level2">
<h2 id="compliance-with-emur">Compliance with emuR<a class="anchor" aria-label="anchor" href="#compliance-with-emur"></a></h2>
<p>The system: - Reads/writes Emu-SDMS JSON annotation format - Maintains SQLite cache consistency - Respects level definitions and hierarchies - Compatible with emuR database structure - Can coexist with emuR functions</p>
<p>Ground truth remains in <code>.json</code> annotation files; cache is updated to match.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/frkkan96" class="external-link">Fredrik Karlsson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


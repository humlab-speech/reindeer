<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Serialization Assessment for Cache Systems in Reindeer • reindeer</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Serialization Assessment for Cache Systems in Reindeer"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">reindeer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.17</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="index.html"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/Tidy_speech_processing.html">Tidy Speech Processing</a></li>
    <li><a class="dropdown-item" href="articles/metadata_management.html">Metadata Management</a></li>
    <li><a class="dropdown-item" href="articles/transcription_workflow.html">Transcription Workflow</a></li>
    <li><a class="dropdown-item" href="articles/simulation-infrastructure.html">Simulation Infrastructure</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/humlab-speech/reindeer"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Serialization Assessment for Cache Systems in Reindeer</h1>

    </div>

<div id="serialization-assessment-for-cache-systems-in-reindeer" class="section level1">

<p><strong>Date:</strong> October 19, 2025<br><strong>Focus:</strong> Cache serialization in <code><a href="reference/enrich.html">enrich()</a></code> and <code><a href="reference/quantify.html">quantify()</a></code> methods</p>
<hr><div class="section level2">
<h2 id="executive-summary">Executive Summary<a class="anchor" aria-label="anchor" href="#executive-summary"></a></h2>
<p>The reindeer package currently uses R’s native <code><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize()</a></code>/<code><a href="https://rdrr.io/r/base/serialize.html" class="external-link">unserialize()</a></code> functions for caching intermediate DSP results in the <code><a href="reference/quantify.html">quantify()</a></code> method. This assessment evaluates alternative serialization schemes to optimize for:</p>
<ol style="list-style-type: decimal"><li>
<strong>Space efficiency</strong> - Reduce cache storage requirements</li>
<li>
<strong>Processing performance</strong> - Faster serialization/deserialization</li>
<li>
<strong>Data integrity</strong> - Preserve data types and structures accurately</li>
</ol><hr></div>
<div class="section level2">
<h2 id="current-implementation">Current Implementation<a class="anchor" aria-label="anchor" href="#current-implementation"></a></h2>
<div class="section level3">
<h3 id="location">Location<a class="anchor" aria-label="anchor" href="#location"></a></h3>
<ul><li>
<strong>File:</strong> <code>R/tidy_trackdata_helpers.R</code>
</li>
<li>
<strong>Functions:</strong> <code>.set_persistent_cache()</code> (line 307), <code>.get_persistent_cache()</code> (line 287)</li>
</ul></div>
<div class="section level3">
<h3 id="current-method-rs-serialize">Current Method: R’s <code>serialize()</code>
<a class="anchor" aria-label="anchor" href="#current-method-rs-serialize"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Serialization (line 309)</span></span>
<span><span class="va">result_blob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize</a></span><span class="op">(</span><span class="va">result</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Deserialization (line 299)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">unserialize</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">result_blob</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="storage-backend">Storage Backend<a class="anchor" aria-label="anchor" href="#storage-backend"></a></h3>
<ul><li>
<strong>Database:</strong> SQLite</li>
<li>
<strong>Table:</strong> <code>cache</code>
</li>
<li>
<strong>Column:</strong> <code>result_blob</code> (BLOB type)</li>
<li>
<strong>Location:</strong> <code>tempdir()/reindeer_cache/quantify_cache.sqlite</code> (default)</li>
</ul></div>
<div class="section level3">
<h3 id="current-cache-architecture">Current Cache Architecture<a class="anchor" aria-label="anchor" href="#current-cache-architecture"></a></h3>
<pre><code>quantify() → .process_segments_vectorized()
    ↓
.get_persistent_cache() ← Check cache
    ↓ (if miss)
Process DSP data
    ↓
.set_persistent_cache() → serialize() → SQLite BLOB</code></pre>
<hr></div>
</div>
<div class="section level2">
<h2 id="evaluated-alternatives">Evaluated Alternatives<a class="anchor" aria-label="anchor" href="#evaluated-alternatives"></a></h2>
<div class="section level3">
<h3 id="id_1-qs-package-quick-serialization">1. <strong>qs Package</strong> (Quick Serialization)<a class="anchor" aria-label="anchor" href="#id_1-qs-package-quick-serialization"></a></h3>
<div class="section level4">
<h4 id="pros">Pros<a class="anchor" aria-label="anchor" href="#pros"></a></h4>
<ul><li>
<strong>Speed:</strong> 2-4x faster serialization, 3-5x faster deserialization than base R</li>
<li>
<strong>Compression:</strong> Better compression ratios (typically 20-40% smaller)</li>
<li>
<strong>Algorithms:</strong> Multiple compression options (lz4, zstd, uncompressed)</li>
<li>
<strong>Maintained:</strong> Active development, CRAN package</li>
<li>
<strong>R-native:</strong> Preserves all R object types perfectly</li>
</ul></div>
<div class="section level4">
<h4 id="cons">Cons<a class="anchor" aria-label="anchor" href="#cons"></a></h4>
<ul><li>
<strong>Dependency:</strong> Adds external package dependency</li>
<li>
<strong>Breaking change:</strong> Cache files not backward compatible with serialize()</li>
<li>
<strong>Documentation:</strong> Less widely known than base R</li>
</ul></div>
<div class="section level4">
<h4 id="performance-estimates">Performance Estimates<a class="anchor" aria-label="anchor" href="#performance-estimates"></a></h4>
<ul><li>Serialization: 2-3x faster</li>
<li>Deserialization: 3-5x faster<br></li>
<li>Storage: 60-80% of serialize() size (with default compression)</li>
<li>Storage: 80-90% of serialize() size (with lz4 - fastest)</li>
</ul></div>
<div class="section level4">
<h4 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a></h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Requires: install.packages("qs")</span></span>
<span><span class="va">result_blob</span> <span class="op">&lt;-</span> <span class="fu">qs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/qs/man/qserialize.html" class="external-link">qserialize</a></span><span class="op">(</span><span class="va">result</span>, preset <span class="op">=</span> <span class="st">"fast"</span><span class="op">)</span>  <span class="co"># or "balanced", "high"</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">qs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/qs/man/qdeserialize.html" class="external-link">qdeserialize</a></span><span class="op">(</span><span class="va">result_blob</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level3">
<h3 id="id_2-fst-package-fast-serialization-of-data-frames">2. <strong>fst Package</strong> (Fast Serialization of Data Frames)<a class="anchor" aria-label="anchor" href="#id_2-fst-package-fast-serialization-of-data-frames"></a></h3>
<div class="section level4">
<h4 id="pros-1">Pros<a class="anchor" aria-label="anchor" href="#pros-1"></a></h4>
<ul><li>
<strong>Speed:</strong> Extremely fast for data frames (10-20x faster than RDS)</li>
<li>
<strong>Compression:</strong> Excellent compression with minimal CPU overhead</li>
<li>
<strong>Column access:</strong> Can read specific columns without loading entire object</li>
<li>
<strong>Multi-threaded:</strong> Uses multiple cores automatically</li>
</ul></div>
<div class="section level4">
<h4 id="cons-1">Cons<a class="anchor" aria-label="anchor" href="#cons-1"></a></h4>
<ul><li>
<strong>Limited types:</strong> Only works with data frames/tibbles</li>
<li>
<strong>Column types:</strong> Limited to common types (numeric, character, factor, Date, POSIXct)</li>
<li>
<strong>Not universal:</strong> Cannot serialize arbitrary R objects (lists, S7 objects)</li>
<li>
<strong>Use case:</strong> Only applicable if quantify results are always data frames</li>
</ul></div>
<div class="section level4">
<h4 id="performance-estimates-for-data-frames-only">Performance Estimates (for data frames only)<a class="anchor" aria-label="anchor" href="#performance-estimates-for-data-frames-only"></a></h4>
<ul><li>Serialization: 10-20x faster than serialize()</li>
<li>Deserialization: 5-10x faster</li>
<li>Storage: 50-70% of serialize() size</li>
</ul></div>
<div class="section level4">
<h4 id="implementation-notes">Implementation Notes<a class="anchor" aria-label="anchor" href="#implementation-notes"></a></h4>
<ul><li>Only viable if we can guarantee quantify() results are always data frames</li>
<li>Current implementation returns data frames, but flexibility may be needed</li>
<li>Would require restructuring cache to use file-based storage instead of BLOB</li>
</ul><hr></div>
</div>
<div class="section level3">
<h3 id="id_3-apache-arrowfeather">3. <strong>Apache Arrow/Feather</strong>
<a class="anchor" aria-label="anchor" href="#id_3-apache-arrowfeather"></a></h3>
<div class="section level4">
<h4 id="pros-2">Pros<a class="anchor" aria-label="anchor" href="#pros-2"></a></h4>
<ul><li>
<strong>Interoperability:</strong> Language-agnostic format (Python, R, C++, Java)</li>
<li>
<strong>Zero-copy:</strong> Extremely fast memory-mapped access</li>
<li>
<strong>Columnar:</strong> Efficient for analytical operations</li>
<li>
<strong>Types:</strong> Rich type system including nested data</li>
</ul></div>
<div class="section level4">
<h4 id="cons-2">Cons<a class="anchor" aria-label="anchor" href="#cons-2"></a></h4>
<ul><li>
<strong>Heavy dependency:</strong> Large package with C++ dependencies</li>
<li>
<strong>Overkill:</strong> More than needed for simple caching</li>
<li>
<strong>Complexity:</strong> Steeper learning curve</li>
<li>
<strong>File-based:</strong> Works with files, not BLOBs (would require architecture change)</li>
</ul></div>
<div class="section level4">
<h4 id="performance-estimates-1">Performance Estimates<a class="anchor" aria-label="anchor" href="#performance-estimates-1"></a></h4>
<ul><li>Serialization: 5-8x faster for data frames</li>
<li>Deserialization: 3-5x faster with memory mapping</li>
<li>Storage: 40-60% of serialize() size (Parquet format)</li>
</ul><hr></div>
</div>
<div class="section level3">
<h3 id="id_4-rds-with-compression-options">4. <strong>RDS with Compression Options</strong>
<a class="anchor" aria-label="anchor" href="#id_4-rds-with-compression-options"></a></h3>
<div class="section level4">
<h4 id="pros-3">Pros<a class="anchor" aria-label="anchor" href="#pros-3"></a></h4>
<ul><li>
<strong>Native:</strong> No dependencies</li>
<li>
<strong>Stable:</strong> Well-tested and reliable</li>
<li>
<strong>Compatible:</strong> Standard R format</li>
</ul></div>
<div class="section level4">
<h4 id="cons-3">Cons<a class="anchor" aria-label="anchor" href="#cons-3"></a></h4>
<ul><li>
<strong>Slower:</strong> Similar or slightly slower than serialize()</li>
<li>
<strong>Compression:</strong> Limited to gzip, bzip2, xz</li>
<li>
<strong>No improvement:</strong> Minimal benefit over current approach</li>
</ul></div>
<div class="section level4">
<h4 id="performance">Performance<a class="anchor" aria-label="anchor" href="#performance"></a></h4>
<ul><li>Similar to current serialize() approach</li>
<li>Not a significant improvement</li>
</ul><hr></div>
</div>
<div class="section level3">
<h3 id="id_5-custom-binary-format">5. <strong>Custom Binary Format</strong>
<a class="anchor" aria-label="anchor" href="#id_5-custom-binary-format"></a></h3>
<div class="section level4">
<h4 id="pros-4">Pros<a class="anchor" aria-label="anchor" href="#pros-4"></a></h4>
<ul><li>
<strong>Optimized:</strong> Tailored to specific data structures</li>
<li>
<strong>Compact:</strong> Can be very space-efficient for known structures</li>
</ul></div>
<div class="section level4">
<h4 id="cons-4">Cons<a class="anchor" aria-label="anchor" href="#cons-4"></a></h4>
<ul><li>
<strong>Maintenance:</strong> Requires ongoing maintenance</li>
<li>
<strong>Complexity:</strong> Higher development cost</li>
<li>
<strong>Fragility:</strong> Can break with data structure changes</li>
<li>
<strong>Not recommended:</strong> Overkill for this use case</li>
</ul><hr></div>
</div>
</div>
<div class="section level2">
<h2 id="benchmark-methodology">Benchmark Methodology<a class="anchor" aria-label="anchor" href="#benchmark-methodology"></a></h2>
<div class="section level3">
<h3 id="test-data-structures">Test Data Structures<a class="anchor" aria-label="anchor" href="#test-data-structures"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Small result:</strong> 100 rows, 5 columns (formant data)</li>
<li>
<strong>Medium result:</strong> 1000 rows, 10 columns (f0 + formants)</li>
<li>
<strong>Large result:</strong> 10000 rows, 20 columns (full spectral data)</li>
</ol></div>
<div class="section level3">
<h3 id="metrics">Metrics<a class="anchor" aria-label="anchor" href="#metrics"></a></h3>
<ol style="list-style-type: decimal"><li>Serialization time (ms)</li>
<li>Deserialization time (ms)</li>
<li>Size in bytes</li>
<li>Compression ratio vs. serialize()</li>
<li>Round-trip fidelity (verify data integrity)</li>
</ol></div>
<div class="section level3">
<h3 id="test-script">Test Script<a class="anchor" aria-label="anchor" href="#test-script"></a></h3>
<p>See <code>benchmarking/benchmark_serialization.R</code></p>
<hr></div>
</div>
<div class="section level2">
<h2 id="recommendations">Recommendations<a class="anchor" aria-label="anchor" href="#recommendations"></a></h2>
<div class="section level3">
<h3 id="primary-recommendation-qs-package">Primary Recommendation: <strong>qs Package</strong>
<a class="anchor" aria-label="anchor" href="#primary-recommendation-qs-package"></a></h3>
<div class="section level4">
<h4 id="rationale">Rationale<a class="anchor" aria-label="anchor" href="#rationale"></a></h4>
<ol style="list-style-type: decimal"><li>
<strong>Best balance:</strong> Significant performance gains without major architecture changes</li>
<li>
<strong>Drop-in replacement:</strong> Minimal code changes required</li>
<li>
<strong>Proven:</strong> Used by many R packages for caching</li>
<li>
<strong>R-native:</strong> Handles all R object types perfectly</li>
<li>
<strong>Compression:</strong> Good space savings with fast algorithms</li>
</ol></div>
<div class="section level4">
<h4 id="implementation-plan">Implementation Plan<a class="anchor" aria-label="anchor" href="#implementation-plan"></a></h4>
<p><strong>Phase 1: Add qs support with fallback (1-2 hours)</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.set_persistent_cache</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cache_key</span>, <span class="va">result</span>, <span class="va">conn</span>, </span>
<span>                                  <span class="va">max_cache_size_mb</span> <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                  <span class="va">use_qs</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Try qs if available and requested</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">use_qs</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"qs"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">result_blob</span> <span class="op">&lt;-</span> <span class="fu">qs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/qs/man/qserialize.html" class="external-link">qserialize</a></span><span class="op">(</span><span class="va">result</span>, preset <span class="op">=</span> <span class="st">"fast"</span><span class="op">)</span></span>
<span>    <span class="va">format</span> <span class="op">&lt;-</span> <span class="st">"qs"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">result_blob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize</a></span><span class="op">(</span><span class="va">result</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="va">format</span> <span class="op">&lt;-</span> <span class="st">"rds"</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">size_bytes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result_blob</span><span class="op">)</span></span>
<span>  <span class="co"># ... rest of function with format column in cache table</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Phase 2: Update cache schema</strong> - Add <code>format</code> column to cache table (“qs” or “rds”) - Allows gradual migration and backward compatibility - Old cache entries still work</p>
<p><strong>Phase 3: Benchmarking</strong> - Compare performance with serialize() - Verify data integrity - Measure cache size reduction</p>
<p><strong>Phase 4: Documentation</strong> - Update user documentation - Add <code>.use_qs</code> parameter to quantify() - Document performance characteristics</p>
</div>
<div class="section level4">
<h4 id="expected-benefits">Expected Benefits<a class="anchor" aria-label="anchor" href="#expected-benefits"></a></h4>
<ul><li>
<strong>Speed:</strong> 2-4x faster cache operations</li>
<li>
<strong>Storage:</strong> 20-40% smaller cache files</li>
<li>
<strong>Backward compatible:</strong> Optional, falls back to serialize()</li>
<li>
<strong>Minimal risk:</strong> Well-tested package</li>
</ul><hr></div>
</div>
<div class="section level3">
<h3 id="alternative-recommendation-fst-conditional">Alternative Recommendation: <strong>fst (Conditional)</strong>
<a class="anchor" aria-label="anchor" href="#alternative-recommendation-fst-conditional"></a></h3>
<p>Only if we can guarantee quantify() always returns data frames and we want maximum speed.</p>
<div class="section level4">
<h4 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a></h4>
<ol style="list-style-type: decimal"><li>Refactor cache to use file-based storage (not SQLite BLOBs)</li>
<li>Ensure all quantify results are coercible to data frames</li>
<li>Handle metadata separately</li>
</ol></div>
<div class="section level4">
<h4 id="benefits-if-applicable">Benefits (if applicable)<a class="anchor" aria-label="anchor" href="#benefits-if-applicable"></a></h4>
<ul><li>
<strong>Speed:</strong> 10-20x faster for large data frames</li>
<li>
<strong>Efficiency:</strong> Excellent for columnar data</li>
<li>
<strong>Multi-threaded:</strong> Automatic parallelization</li>
</ul></div>
<div class="section level4">
<h4 id="implementation-complexity">Implementation Complexity<a class="anchor" aria-label="anchor" href="#implementation-complexity"></a></h4>
<ul><li>Medium to high</li>
<li>Requires cache architecture redesign</li>
<li>Benefits may not justify complexity for typical use cases</li>
</ul><hr></div>
</div>
<div class="section level3">
<h3 id="not-recommended">NOT Recommended<a class="anchor" aria-label="anchor" href="#not-recommended"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Arrow/Feather:</strong> Too heavy for this use case</li>
<li>
<strong>Custom format:</strong> Unnecessary complexity</li>
<li>
<strong>RDS variants:</strong> No significant improvement</li>
<li>
<strong>No change:</strong> Missing optimization opportunity</li>
</ol><hr></div>
</div>
<div class="section level2">
<h2 id="implementation-priority">Implementation Priority<a class="anchor" aria-label="anchor" href="#implementation-priority"></a></h2>
<div class="section level3">
<h3 id="high-priority-recommended">High Priority (Recommended)<a class="anchor" aria-label="anchor" href="#high-priority-recommended"></a></h3>
<ul><li>✅ <strong>qs package integration</strong> - Best cost/benefit ratio</li>
</ul></div>
<div class="section level3">
<h3 id="medium-priority-nice-to-have">Medium Priority (Nice to have)<a class="anchor" aria-label="anchor" href="#medium-priority-nice-to-have"></a></h3>
<ul><li>Consider fst for specific large-scale scenarios</li>
<li>Add benchmarking infrastructure for cache performance</li>
<li>Allow user-configurable cache location</li>
</ul></div>
<div class="section level3">
<h3 id="low-priority">Low Priority<a class="anchor" aria-label="anchor" href="#low-priority"></a></h3>
<ul><li>Investigate cache compression strategies</li>
<li>Implement cache analytics (hit rate, size trends)</li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="testing-requirements">Testing Requirements<a class="anchor" aria-label="anchor" href="#testing-requirements"></a></h2>
<div class="section level3">
<h3 id="functional-tests">Functional Tests<a class="anchor" aria-label="anchor" href="#functional-tests"></a></h3>
<ol style="list-style-type: decimal"><li>Serialization round-trip fidelity</li>
<li>Backward compatibility with existing caches</li>
<li>Error handling for corrupted cache entries</li>
<li>Cache size limits working correctly</li>
</ol></div>
<div class="section level3">
<h3 id="performance-tests">Performance Tests<a class="anchor" aria-label="anchor" href="#performance-tests"></a></h3>
<ol style="list-style-type: decimal"><li>Benchmark serialization speed</li>
<li>Benchmark deserialization speed</li>
<li>Measure cache size reduction</li>
<li>Compare memory usage</li>
</ol></div>
<div class="section level3">
<h3 id="integration-tests">Integration Tests<a class="anchor" aria-label="anchor" href="#integration-tests"></a></h3>
<ol style="list-style-type: decimal"><li>quantify() with cache enabled/disabled</li>
<li>Large corpus processing</li>
<li>Parallel processing with caching</li>
<li>Cache invalidation logic</li>
</ol><hr></div>
</div>
<div class="section level2">
<h2 id="migration-strategy">Migration Strategy<a class="anchor" aria-label="anchor" href="#migration-strategy"></a></h2>
<div class="section level3">
<h3 id="for-existing-users">For Existing Users<a class="anchor" aria-label="anchor" href="#for-existing-users"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Default behavior:</strong> Continue using serialize() for now</li>
<li>
<strong>Opt-in:</strong> Add <code>.cache_format = "qs"</code> parameter</li>
<li>
<strong>Future:</strong> Switch to qs as default in next major version</li>
<li>
<strong>Migration tool:</strong> Provide function to convert cache formats</li>
</ol></div>
<div class="section level3">
<h3 id="cache-format-handling">Cache Format Handling<a class="anchor" aria-label="anchor" href="#cache-format-handling"></a></h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Detect format and deserialize accordingly</span></span>
<span><span class="va">.get_persistent_cache</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cache_key</span>, <span class="va">conn</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">conn</span>, </span>
<span>    <span class="st">"SELECT result_blob, format FROM cache WHERE cache_key = ?"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cache_key</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">format</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">format</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="reference/grapes-or-or-grapes.html">%||%</a></span> <span class="st">"rds"</span>  <span class="co"># Default to rds for old entries</span></span>
<span>    </span>
<span>    <span class="va">blob</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">result_blob</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">format</span> <span class="op">==</span> <span class="st">"qs"</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"qs"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">qs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/qs/man/qdeserialize.html" class="external-link">qdeserialize</a></span><span class="op">(</span><span class="va">blob</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">unserialize</a></span><span class="op">(</span><span class="va">blob</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Update access time</span></span>
<span>    <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">conn</span>, </span>
<span>      <span class="st">"UPDATE cache SET accessed_at = ? WHERE cache_key = ?"</span>,</span>
<span>      params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="va">cache_key</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="cost-benefit-analysis">Cost-Benefit Analysis<a class="anchor" aria-label="anchor" href="#cost-benefit-analysis"></a></h2>
<div class="section level3">
<h3 id="qs-integration">qs Integration<a class="anchor" aria-label="anchor" href="#qs-integration"></a></h3>
<table class="table"><thead><tr><th>Aspect</th>
<th>Cost</th>
<th>Benefit</th>
</tr></thead><tbody><tr><td>Development</td>
<td>2-3 hours</td>
<td>One-time</td>
</tr><tr><td>Testing</td>
<td>2-3 hours</td>
<td>One-time</td>
</tr><tr><td>Documentation</td>
<td>1 hour</td>
<td>One-time</td>
</tr><tr><td>New dependency</td>
<td>Minimal (0.5 MB)</td>
<td>Well-maintained CRAN package</td>
</tr><tr><td>Performance gain</td>
<td>-</td>
<td>2-4x faster cache operations</td>
</tr><tr><td>Storage savings</td>
<td>-</td>
<td>20-40% smaller cache</td>
</tr><tr><td>User impact</td>
<td>None (optional)</td>
<td>Faster workflows</td>
</tr></tbody></table><p><strong>Total effort:</strong> ~6 hours<br><strong>Expected improvement:</strong> 2-4x cache performance, 20-40% storage savings</p>
</div>
<div class="section level3">
<h3 id="roi-calculation">ROI Calculation<a class="anchor" aria-label="anchor" href="#roi-calculation"></a></h3>
<p>For a typical workflow with 1000 cached results: - Time saved per operation: ~10-50ms - Total time saved: 10-50 seconds per workflow - Cache size reduction: 50-200 MB typical</p>
<p>For large-scale analysis (10,000+ segments): - Time saved: 2-5 minutes per analysis - Cache size reduction: 500 MB - 2 GB</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a></h2>
<p>The <strong>qs package</strong> provides the best balance of performance improvement, ease of implementation, and minimal risk. It offers 2-4x faster cache operations and 20-40% storage savings with only a small additional dependency.</p>
<p>The implementation can be done in a backward-compatible, opt-in manner, allowing gradual migration and minimal disruption to existing users.</p>
<p><strong>Recommended action:</strong> Implement qs support as an optional feature with fallback to serialize(), then benchmark real-world performance gains before making it the default.</p>
<hr></div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
<ol style="list-style-type: decimal"><li>qs package: <a href="https://cran.r-project.org/package=qs" class="external-link uri">https://cran.r-project.org/package=qs</a>
</li>
<li>fst package: <a href="https://www.fstpackage.org/" class="external-link uri">https://www.fstpackage.org/</a>
</li>
<li>Apache Arrow R: <a href="https://arrow.apache.org/docs/r/" class="external-link uri">https://arrow.apache.org/docs/r/</a>
</li>
<li>R serialize documentation: <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/serialize.html" class="external-link uri">https://stat.ethz.ch/R-manual/R-devel/library/base/html/serialize.html</a>
</li>
</ol><hr></div>
<div class="section level2">
<h2 id="appendix-code-examples">Appendix: Code Examples<a class="anchor" aria-label="anchor" href="#appendix-code-examples"></a></h2>
<div class="section level3">
<h3 id="example-1-current-implementation">Example 1: Current Implementation<a class="anchor" aria-label="anchor" href="#example-1-current-implementation"></a></h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Current cache set (tidy_trackdata_helpers.R:307)</span></span>
<span><span class="va">.set_persistent_cache</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cache_key</span>, <span class="va">result</span>, <span class="va">conn</span>, <span class="va">max_cache_size_mb</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result_blob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize</a></span><span class="op">(</span><span class="va">result</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="va">size_bytes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result_blob</span><span class="op">)</span></span>
<span>  <span class="va">current_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"</span></span>
<span><span class="st">    INSERT OR REPLACE INTO cache (cache_key, result_blob, created_at, accessed_at, size_bytes)</span></span>
<span><span class="st">    VALUES (?, ?, ?, ?, ?)</span></span>
<span><span class="st">  "</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cache_key</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">result_blob</span><span class="op">)</span>, <span class="va">current_time</span>, <span class="va">current_time</span>, <span class="va">size_bytes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2-proposed-qs-implementation">Example 2: Proposed qs Implementation<a class="anchor" aria-label="anchor" href="#example-2-proposed-qs-implementation"></a></h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.set_persistent_cache</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cache_key</span>, <span class="va">result</span>, <span class="va">conn</span>, </span>
<span>                                  <span class="va">max_cache_size_mb</span> <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                  <span class="va">format</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"qs"</span>, <span class="st">"rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">format</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">format</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Determine format</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">format</span> <span class="op">==</span> <span class="st">"auto"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">format</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"qs"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="st">"qs"</span> <span class="kw">else</span> <span class="st">"rds"</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Serialize</span></span>
<span>  <span class="va">result_blob</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">format</span> <span class="op">==</span> <span class="st">"qs"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">qs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/qs/man/qserialize.html" class="external-link">qserialize</a></span><span class="op">(</span><span class="va">result</span>, preset <span class="op">=</span> <span class="st">"fast"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize</a></span><span class="op">(</span><span class="va">result</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">size_bytes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result_blob</span><span class="op">)</span></span>
<span>  <span class="va">current_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Store with format marker</span></span>
<span>  <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"</span></span>
<span><span class="st">    INSERT OR REPLACE INTO cache </span></span>
<span><span class="st">    (cache_key, result_blob, format, created_at, accessed_at, size_bytes)</span></span>
<span><span class="st">    VALUES (?, ?, ?, ?, ?, ?)</span></span>
<span><span class="st">  "</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cache_key</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">result_blob</span><span class="op">)</span>, <span class="va">format</span>, </span>
<span>                   <span class="va">current_time</span>, <span class="va">current_time</span>, <span class="va">size_bytes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3-migration-helper">Example 3: Migration Helper<a class="anchor" aria-label="anchor" href="#example-3-migration-helper"></a></h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Convert cache format from RDS to qs</span></span>
<span><span class="co">#' @param cache_dir Cache directory path</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">convert_cache_format</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cache_dir</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"qs"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_abort</a></span><span class="op">(</span><span class="st">"qs package required for cache conversion"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">conn</span> <span class="op">&lt;-</span> <span class="fu">.get_persistent_cache_connection</span><span class="op">(</span><span class="va">cache_dir</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">conn</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get all RDS entries</span></span>
<span>  <span class="va">entries</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"</span></span>
<span><span class="st">    SELECT cache_key, result_blob FROM cache </span></span>
<span><span class="st">    WHERE format = 'rds' OR format IS NULL</span></span>
<span><span class="st">  "</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">entries</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_info</a></span><span class="op">(</span><span class="st">"No entries to convert"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_info</a></span><span class="op">(</span><span class="st">"Converting {nrow(entries)} cache entries to qs format"</span><span class="op">)</span></span>
<span>  <span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_bar.html" class="external-link">cli_progress_bar</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">entries</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">entries</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Deserialize with RDS</span></span>
<span>    <span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">unserialize</a></span><span class="op">(</span><span class="va">entries</span><span class="op">$</span><span class="va">result_blob</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Reserialize with qs</span></span>
<span>    <span class="va">new_blob</span> <span class="op">&lt;-</span> <span class="fu">qs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/qs/man/qserialize.html" class="external-link">qserialize</a></span><span class="op">(</span><span class="va">obj</span>, preset <span class="op">=</span> <span class="st">"fast"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Update in database</span></span>
<span>    <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">conn</span>, <span class="st">"</span></span>
<span><span class="st">      UPDATE cache </span></span>
<span><span class="st">      SET result_blob = ?, format = 'qs', size_bytes = ?</span></span>
<span><span class="st">      WHERE cache_key = ?</span></span>
<span><span class="st">    "</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">new_blob</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">new_blob</span><span class="op">)</span>, <span class="va">entries</span><span class="op">$</span><span class="va">cache_key</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_bar.html" class="external-link">cli_progress_update</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">pb</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_bar.html" class="external-link">cli_progress_done</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">pb</span><span class="op">)</span></span>
<span>  <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_success</a></span><span class="op">(</span><span class="st">"Cache conversion complete"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/frkkan96" class="external-link">Fredrik Karlsson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


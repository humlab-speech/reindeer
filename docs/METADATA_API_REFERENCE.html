<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Metadata System API Reference • reindeer</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Metadata System API Reference"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">reindeer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.17</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="index.html"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/Tidy_speech_processing.html">Tidy Speech Processing</a></li>
    <li><a class="dropdown-item" href="articles/metadata_management.html">Metadata Management</a></li>
    <li><a class="dropdown-item" href="articles/transcription_workflow.html">Transcription Workflow</a></li>
    <li><a class="dropdown-item" href="articles/simulation-infrastructure.html">Simulation Infrastructure</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/humlab-speech/reindeer"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Metadata System API Reference</h1>

    </div>

<div id="metadata-system-api-reference" class="section level1">

<div class="section level2">
<h2 id="core-functions">Core Functions<a class="anchor" aria-label="anchor" href="#core-functions"></a></h2>
<div class="section level3">
<h3 id="gather_metadata">gather_metadata()<a class="anchor" aria-label="anchor" href="#gather_metadata"></a></h3>
<p>Scan all .meta_json files and populate the SQL cache.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/gather_metadata.html">gather_metadata</a></span><span class="op">(</span><span class="va">corpus_obj</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Parameters:</strong> - <code>corpus_obj</code>: A corpus object - <code>verbose</code>: Show progress messages (default: TRUE)</p>
<p><strong>Returns:</strong> The corpus object (invisibly)</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/corpus.html">corpus</a></span><span class="op">(</span><span class="st">"path/to/ae_emuDB"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/gather_metadata.html">gather_metadata</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="get_metadata">get_metadata()<a class="anchor" aria-label="anchor" href="#get_metadata"></a></h3>
<p>Retrieve metadata for all bundles with inheritance resolved.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="va">corpus_obj</span>, session_pattern <span class="op">=</span> <span class="st">".*"</span>, bundle_pattern <span class="op">=</span> <span class="st">".*"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Parameters:</strong> - <code>corpus_obj</code>: A corpus object - <code>session_pattern</code>: Regex to filter sessions (default: “.<em>”) - <code>bundle_pattern</code>: Regex to filter bundles (default: ”.</em>”)</p>
<p><strong>Returns:</strong> A tibble with columns: session, bundle, and all metadata fields</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All bundles</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specific session</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="va">ae</span>, session_pattern <span class="op">=</span> <span class="st">"Session1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specific bundles</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="va">ae</span>, bundle_pattern <span class="op">=</span> <span class="st">"Recording.*"</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="add_metadata">add_metadata()<a class="anchor" aria-label="anchor" href="#add_metadata"></a></h3>
<p>Set metadata at database, session, or bundle level.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">corpus_obj</span>, <span class="va">metadataList</span>, session <span class="op">=</span> <span class="cn">NULL</span>, bundle <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>            reset.before.add <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Parameters:</strong> - <code>corpus_obj</code>: A corpus object - <code>metadataList</code>: Named list of metadata key-value pairs - <code>session</code>: Session name (optional) - <code>bundle</code>: Bundle name (optional, requires session) - <code>reset.before.add</code>: Clear existing metadata first (default: FALSE)</p>
<p><strong>Returns:</strong> The corpus object (invisibly)</p>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Database level</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Project <span class="op">=</span> <span class="st">"Study2024"</span>, Year <span class="op">=</span> <span class="fl">2024</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Session level</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Speaker <span class="op">=</span> <span class="st">"P001"</span>, Age <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, session <span class="op">=</span> <span class="st">"S1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bundle level</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Quality <span class="op">=</span> <span class="st">"Good"</span><span class="op">)</span>, session <span class="op">=</span> <span class="st">"S1"</span>, bundle <span class="op">=</span> <span class="st">"B1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reset and replace</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>NewField <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span>, session <span class="op">=</span> <span class="st">"S1"</span>, bundle <span class="op">=</span> <span class="st">"B1"</span>,</span>
<span>            reset.before.add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="id_-corpus"><code>[&lt;-.corpus</code><a class="anchor" aria-label="anchor" href="#id_-corpus"></a></h3>
<p>Bracket notation for setting bundle metadata.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corpus_obj</span><span class="op">[</span><span class="st">"session"</span>, <span class="st">"bundle"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>field <span class="op">=</span> <span class="va">value</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p><strong>Parameters:</strong> - <code>session</code>: Session name - <code>bundle</code>: Bundle name - <code>value</code>: Named list of metadata</p>
<p><strong>Returns:</strong> The corpus object (invisibly)</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae</span><span class="op">[</span><span class="st">"Session1"</span>, <span class="st">"Bundle1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Age <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  Gender <span class="op">=</span> <span class="st">"Female"</span>,</span>
<span>  Quality <span class="op">=</span> <span class="st">"Excellent"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="export_metadata">export_metadata()<a class="anchor" aria-label="anchor" href="#export_metadata"></a></h3>
<p>Export metadata to Excel workbook.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/export_metadata.html">export_metadata</a></span><span class="op">(</span><span class="va">corpus_obj</span>, <span class="va">Excelfile</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>               mandatory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Age"</span>, <span class="st">"Gender"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Parameters:</strong> - <code>corpus_obj</code>: A corpus object - <code>Excelfile</code>: Path to output Excel file - <code>overwrite</code>: Overwrite existing file (default: FALSE) - <code>mandatory</code>: Fields to ensure are present (default: c(“Age”, “Gender”))</p>
<p><strong>Returns:</strong> The bundle metadata tibble (invisibly)</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/export_metadata.html">export_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="st">"corpus_metadata.xlsx"</span>, </span>
<span>               overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               mandatory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Age"</span>, <span class="st">"Gender"</span>, <span class="st">"Dialect"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Excel Structure:</strong> - Sheet 1 “bundles”: One row per bundle with all metadata - Sheet 2 “sessions”: One row per session with session-level metadata - Sheet 3 “database”: One row with database-level defaults</p>
<hr></div>
<div class="section level3">
<h3 id="import_metadata">import_metadata()<a class="anchor" aria-label="anchor" href="#import_metadata"></a></h3>
<p>Import metadata from Excel workbook.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/import_metadata.html">import_metadata</a></span><span class="op">(</span><span class="va">corpus_obj</span>, <span class="va">Excelfile</span><span class="op">)</span></span></code></pre></div>
<p><strong>Parameters:</strong> - <code>corpus_obj</code>: A corpus object - <code>Excelfile</code>: Path to Excel file to import</p>
<p><strong>Returns:</strong> The corpus object (invisibly)</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/import_metadata.html">import_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="st">"edited_metadata.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Notes:</strong> - Automatically updates .meta_json files (ground truth) - Rebuilds SQL cache after import - Expects Excel format from <code><a href="reference/export_metadata.html">export_metadata()</a></code></p>
<hr></div>
<div class="section level3">
<h3 id="biographize">biographize()<a class="anchor" aria-label="anchor" href="#biographize"></a></h3>
<p>Add metadata to query results.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/biographize.html">biographize</a></span><span class="op">(</span><span class="va">segs_tbl</span>, <span class="va">corpus_obj</span>, compute_digests <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>           algorithm <span class="op">=</span> <span class="st">"sha1"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Parameters:</strong> - <code>segs_tbl</code>: Tibble from query with session and bundle columns - <code>corpus_obj</code>: A corpus object - <code>compute_digests</code>: Compute file checksums (default: FALSE) - <code>algorithm</code>: Hash algorithm for digests (default: “sha1”)</p>
<p><strong>Returns:</strong> The segment tibble with metadata columns added</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vowels</span> <span class="op">&lt;-</span> <span class="fu">query_opt</span><span class="op">(</span><span class="va">ae</span>, <span class="st">"Phonetic=~'[aeiou]'"</span><span class="op">)</span></span>
<span><span class="va">vowels_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/biographize.html">biographize</a></span><span class="op">(</span><span class="va">vowels</span>, <span class="va">ae</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now can filter/group by metadata</span></span>
<span><span class="va">vowels_meta</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Age</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Gender</span>, <span class="va">label</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">end</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="summarycorpus">summary.corpus()<a class="anchor" aria-label="anchor" href="#summarycorpus"></a></h3>
<p>Enhanced corpus summary with metadata diagnostics.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">corpus_obj</span><span class="op">)</span></span></code></pre></div>
<p><strong>Parameters:</strong> - <code>corpus_obj</code>: A corpus object</p>
<p><strong>Returns:</strong> The corpus object (invisibly)</p>
<p><strong>Output Includes:</strong> - Basic info: name, UUID, path - Counts: sessions, bundles, items, labels, links - SSFF track definitions - Level definitions - Link definitions - Metadata diagnostics: fields, types, coverage</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="internal-functions">Internal Functions<a class="anchor" aria-label="anchor" href="#internal-functions"></a></h2>
<p>These are used internally but documented for developers.</p>
<div class="section level3">
<h3 id="initialize_metadata_schema">initialize_metadata_schema()<a class="anchor" aria-label="anchor" href="#initialize_metadata_schema"></a></h3>
<p>Create metadata tables in SQL cache.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/initialize_metadata_schema.html">initialize_metadata_schema</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="process_metadata_list">process_metadata_list()<a class="anchor" aria-label="anchor" href="#process_metadata_list"></a></h3>
<p>Insert metadata into cache tables.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/process_metadata_list.html">process_metadata_list</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">db_uuid</span>, <span class="va">session</span>, <span class="va">bundle</span>, <span class="va">meta_list</span>, <span class="va">level</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="serialize_metadata_value">serialize_metadata_value()<a class="anchor" aria-label="anchor" href="#serialize_metadata_value"></a></h3>
<p>Convert R value to SQL-compatible string.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/serialize_metadata_value.html">serialize_metadata_value</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span></code></pre></div>
<p><strong>Returns:</strong> List with <code>value</code> (string) and <code>type</code> (character)</p>
<hr></div>
<div class="section level3">
<h3 id="deserialize_metadata_value">deserialize_metadata_value()<a class="anchor" aria-label="anchor" href="#deserialize_metadata_value"></a></h3>
<p>Convert SQL string back to R value.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/deserialize_metadata_value.html">deserialize_metadata_value</a></span><span class="op">(</span><span class="va">value_str</span>, <span class="va">type_str</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="register_metadata_field">register_metadata_field()<a class="anchor" aria-label="anchor" href="#register_metadata_field"></a></h3>
<p>Register new metadata field in tracking table.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/register_metadata_field.html">register_metadata_field</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">field_name</span>, <span class="va">field_type</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="get_metadata_field">get_metadata_field()<a class="anchor" aria-label="anchor" href="#get_metadata_field"></a></h3>
<p>Get values for one field across bundles with inheritance.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_metadata_field.html">get_metadata_field</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">db_uuid</span>, <span class="va">field_name</span>, <span class="va">sessions</span>, <span class="va">bundles</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="get_metadata_diagnostics">get_metadata_diagnostics()<a class="anchor" aria-label="anchor" href="#get_metadata_diagnostics"></a></h3>
<p>Generate metadata diagnostics for summary.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">get_metadata_diagnostics</span><span class="op">(</span><span class="va">con</span>, <span class="va">db_uuid</span><span class="op">)</span></span></code></pre></div>
<p><strong>Returns:</strong> Tibble with field statistics or NULL</p>
<hr></div>
<div class="section level3">
<h3 id="set_metadata_validated">set_metadata_validated()<a class="anchor" aria-label="anchor" href="#set_metadata_validated"></a></h3>
<p>Validate metadata before setting.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/set_metadata_validated.html">set_metadata_validated</a></span><span class="op">(</span><span class="va">corpus_obj</span>, <span class="va">meta_list</span>, <span class="va">session</span>, <span class="va">bundle</span>, <span class="va">level</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="write_metadata_to_json">write_metadata_to_json()<a class="anchor" aria-label="anchor" href="#write_metadata_to_json"></a></h3>
<p>Update .meta_json files with new metadata.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/write_metadata_to_json.html">write_metadata_to_json</a></span><span class="op">(</span><span class="va">corpus_obj</span>, <span class="va">meta_list</span>, <span class="va">session</span>, <span class="va">bundle</span>, <span class="va">level</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="get_db_uuid">get_db_uuid()<a class="anchor" aria-label="anchor" href="#get_db_uuid"></a></h3>
<p>Extract database UUID from corpus.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_db_uuid.html">get_db_uuid</a></span><span class="op">(</span><span class="va">corpus_obj</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="get_connection">get_connection()<a class="anchor" aria-label="anchor" href="#get_connection"></a></h3>
<p>Get SQL connection to cache database.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_connection.html">get_connection</a></span><span class="op">(</span><span class="va">corpus_obj</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="list_sessions_from_cache">list_sessions_from_cache()<a class="anchor" aria-label="anchor" href="#list_sessions_from_cache"></a></h3>
<p>List sessions from SQL cache.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/list_sessions_from_cache.html">list_sessions_from_cache</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">db_uuid</span><span class="op">)</span></span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="list_bundles_from_cache">list_bundles_from_cache()<a class="anchor" aria-label="anchor" href="#list_bundles_from_cache"></a></h3>
<p>List bundles from SQL cache.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/list_bundles_from_cache.html">list_bundles_from_cache</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">db_uuid</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="sql-schema">SQL Schema<a class="anchor" aria-label="anchor" href="#sql-schema"></a></h2>
<div class="section level3">
<h3 id="metadata_fields">metadata_fields<a class="anchor" aria-label="anchor" href="#metadata_fields"></a></h3>
<p>Tracks all known metadata field names and types.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> metadata_fields (</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  field_name TEXT <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>  field_type TEXT,</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>  first_seen TEXT,</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>  last_modified TEXT</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>);</span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="metadata_database">metadata_database<a class="anchor" aria-label="anchor" href="#metadata_database"></a></h3>
<p>Database-level default metadata values.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> metadata_database (</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  db_uuid <span class="dt">VARCHAR</span>(<span class="dv">36</span>),</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  field_name TEXT,</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  field_value TEXT,</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  field_type TEXT,</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (db_uuid, field_name),</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>  <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (db_uuid) <span class="kw">REFERENCES</span> emu_db(uuid)</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>);</span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="metadata_session">metadata_session<a class="anchor" aria-label="anchor" href="#metadata_session"></a></h3>
<p>Session-level metadata overrides.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> metadata_session (</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  db_uuid <span class="dt">VARCHAR</span>(<span class="dv">36</span>),</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  <span class="kw">session</span> TEXT,</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  field_name TEXT,</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>  field_value TEXT,</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>  field_type TEXT,</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (db_uuid, <span class="kw">session</span>, field_name),</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>  <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (db_uuid, <span class="kw">session</span>) <span class="kw">REFERENCES</span> <span class="kw">session</span>(db_uuid, name)</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>);</span></code></pre></div>
<hr></div>
<div class="section level3">
<h3 id="metadata_bundle">metadata_bundle<a class="anchor" aria-label="anchor" href="#metadata_bundle"></a></h3>
<p>Bundle-specific metadata.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> metadata_bundle (</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  db_uuid <span class="dt">VARCHAR</span>(<span class="dv">36</span>),</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>  <span class="kw">session</span> TEXT,</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>  bundle TEXT,</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>  field_name TEXT,</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>  field_value TEXT,</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>  field_type TEXT,</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (db_uuid, <span class="kw">session</span>, bundle, field_name),</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>  <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (db_uuid, <span class="kw">session</span>, bundle) <span class="kw">REFERENCES</span> bundle</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>);</span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="type-system">Type System<a class="anchor" aria-label="anchor" href="#type-system"></a></h2>
<div class="section level3">
<h3 id="supported-types">Supported Types<a class="anchor" aria-label="anchor" href="#supported-types"></a></h3>
<ul><li>
<code>character</code>: Text values</li>
<li>
<code>numeric</code>: Decimal numbers</li>
<li>
<code>integer</code>: Whole numbers</li>
<li>
<code>logical</code>: TRUE/FALSE values</li>
<li>
<code>date</code>: Date objects (serialized as ISO 8601)</li>
<li>
<code>datetime</code>: POSIXct timestamps (serialized as ISO 8601)</li>
</ul></div>
<div class="section level3">
<h3 id="type-conversion">Type Conversion<a class="anchor" aria-label="anchor" href="#type-conversion"></a></h3>
<p>When setting metadata with a different type than previously used:</p>
<ol style="list-style-type: decimal"><li>
<strong>Compatible types</strong>: Automatically converted with warning
<ul><li>numeric → integer</li>
<li>integer → numeric</li>
</ul></li>
<li>
<strong>Incompatible types</strong>: Error with message
<ul><li>numeric → character</li>
<li>logical → date</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="type-validation">Type Validation<a class="anchor" aria-label="anchor" href="#type-validation"></a></h3>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First use establishes type</span></span>
<span><span class="va">ae</span><span class="op">[</span><span class="st">"S1"</span>, <span class="st">"B1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>  <span class="co"># Type: numeric</span></span>
<span></span>
<span><span class="co"># Compatible</span></span>
<span><span class="va">ae</span><span class="op">[</span><span class="st">"S1"</span>, <span class="st">"B2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>  <span class="co"># OK</span></span>
<span></span>
<span><span class="co"># Incompatible</span></span>
<span><span class="va">ae</span><span class="op">[</span><span class="st">"S1"</span>, <span class="st">"B3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="st">"thirty"</span><span class="op">)</span>  <span class="co"># Error</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="performance">Performance<a class="anchor" aria-label="anchor" href="#performance"></a></h2>
<div class="section level3">
<h3 id="benchmarks">Benchmarks<a class="anchor" aria-label="anchor" href="#benchmarks"></a></h3>
<p>On corpus with 1000 bundles:</p>
<table class="table"><thead><tr><th>Operation</th>
<th>Old</th>
<th>New</th>
<th>Speedup</th>
</tr></thead><tbody><tr><td>gather_metadata</td>
<td>45s</td>
<td>2.1s</td>
<td>21x</td>
</tr><tr><td>get_metadata</td>
<td>12s</td>
<td>0.08s</td>
<td>150x</td>
</tr><tr><td>add_metadata</td>
<td>0.5s</td>
<td>0.02s</td>
<td>25x</td>
</tr><tr><td>export_metadata</td>
<td>15s</td>
<td>1.2s</td>
<td>12x</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="optimization-techniques">Optimization Techniques<a class="anchor" aria-label="anchor" href="#optimization-techniques"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>SQL caching</strong>: Avoid repeated file I/O</li>
<li>
<strong>Batch operations</strong>: Transactions for multiple inserts</li>
<li>
<strong>Indexed queries</strong>: Foreign key and field name indices</li>
<li>
<strong>Lazy evaluation</strong>: Only load when needed</li>
<li>
<strong>Connection pooling</strong>: Reuse database connections</li>
</ol><hr></div>
</div>
<div class="section level2">
<h2 id="inheritance-algorithm">Inheritance Algorithm<a class="anchor" aria-label="anchor" href="#inheritance-algorithm"></a></h2>
<p>When retrieving metadata:</p>
<pre><code>For each bundle:
  For each field:
    1. Check bundle-level metadata
    2. If not found, check session-level
    3. If not found, check database-level
    4. If not found, return NA</code></pre>
<p>This is efficiently implemented with SQL LEFT JOINs and COALESCE.</p>
<hr></div>
<div class="section level2">
<h2 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h2>
<div class="section level3">
<h3 id="common-errors">Common Errors<a class="anchor" aria-label="anchor" href="#common-errors"></a></h3>
<p><strong>“Cache file not found”</strong></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Solution: Build cache</span></span>
<span><span class="va">ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/corpus.html">corpus</a></span><span class="op">(</span><span class="st">"path"</span><span class="op">)</span>  <span class="co"># Automatically builds cache</span></span></code></pre></div>
<p><strong>“Type mismatch for field Age”</strong></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Solution: Use compatible type or reset</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, session <span class="op">=</span> <span class="st">"S1"</span>, bundle <span class="op">=</span> <span class="st">"B1"</span>, </span>
<span>            reset.before.add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>“Field ‘NewField’ is new”</strong></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In interactive mode, confirm:</span></span>
<span><span class="co"># &gt; Field 'NewField' is new. Add it as type 'character'? (y/n): y</span></span></code></pre></div>
<p><strong>“Package openxlsx required”</strong></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Solution: Install openxlsx</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"openxlsx"</span><span class="op">)</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a></h2>
<ol style="list-style-type: decimal"><li>
<p><strong>Call gather_metadata() after manual edits</strong></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># After editing .meta_json files manually</span></span>
<span><span class="fu"><a href="reference/gather_metadata.html">gather_metadata</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Use database level for constants</strong></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Project <span class="op">=</span> <span class="st">"Study2024"</span>, Institution <span class="op">=</span> <span class="st">"Uni X"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Use session level for speaker properties</strong></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">25</span>, Gender <span class="op">=</span> <span class="st">"Female"</span><span class="op">)</span>, session <span class="op">=</span> <span class="st">"S1"</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Use bundle level for recording details</strong></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae</span><span class="op">[</span><span class="st">"S1"</span>, <span class="st">"B1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, Quality <span class="op">=</span> <span class="st">"Good"</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Check summary() for inconsistencies</strong></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span>  <span class="co"># Look for unexpected fields or types</span></span></code></pre></div>
</li>
<li>
<p><strong>Use Excel for batch corrections</strong></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/export_metadata.html">export_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="st">"meta.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># Edit in Excel</span></span>
<span><span class="fu"><a href="reference/import_metadata.html">import_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="st">"meta.xlsx"</span><span class="op">)</span></span></code></pre></div>
</li>
</ol><hr></div>
<div class="section level2">
<h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
<ul><li>
<code>METADATA_SYSTEM.md</code> - Technical documentation</li>
<li>
<code>vignettes/metadata_management.Rmd</code> - User tutorial</li>
<li>
<code>METADATA_README.md</code> - Getting started guide</li>
<li>
<code>tests/testthat/test_metadata_optimized.R</code> - Test examples</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/frkkan96" class="external-link">Fredrik Karlsson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


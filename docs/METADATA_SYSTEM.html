<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimized Metadata Management System for Reindeer • reindeer</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Optimized Metadata Management System for Reindeer"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">reindeer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.17</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="index.html"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/Tidy_speech_processing.html">Tidy Speech Processing</a></li>
    <li><a class="dropdown-item" href="articles/metadata_management.html">Metadata Management</a></li>
    <li><a class="dropdown-item" href="articles/transcription_workflow.html">Transcription Workflow</a></li>
    <li><a class="dropdown-item" href="articles/simulation-infrastructure.html">Simulation Infrastructure</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/humlab-speech/reindeer"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Optimized Metadata Management System for Reindeer</h1>

    </div>

<div id="optimized-metadata-management-system-for-reindeer" class="section level1">

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p>The reindeer package now includes a highly optimized metadata management system that:</p>
<ol style="list-style-type: decimal"><li>
<strong>Caches metadata in SQLite</strong> for fast retrieval</li>
<li><strong>Respects the .meta_json files as ground truth</strong></li>
<li>
<strong>Implements proper inheritance</strong> (database → session → bundle)</li>
<li>
<strong>Provides elegant programmatic access</strong> with validation</li>
<li>
<strong>Includes diagnostic tools</strong> for identifying misspelled fields</li>
<li>
<strong>Supports Excel import/export</strong> for convenient batch editing</li>
</ol></div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a></h2>
<div class="section level3">
<h3 id="three-level-hierarchy">Three-Level Hierarchy<a class="anchor" aria-label="anchor" href="#three-level-hierarchy"></a></h3>
<p>Metadata can be set at three levels with proper precedence:</p>
<ol style="list-style-type: decimal"><li>
<strong>Database level</strong>: Default values for all bundles</li>
<li>
<strong>Session level</strong>: Overrides database defaults for all bundles in a session</li>
<li>
<strong>Bundle level</strong>: Overrides session and database values for a specific bundle</li>
</ol></div>
<div class="section level3">
<h3 id="ground-truth-meta_json-files">Ground Truth: .meta_json Files<a class="anchor" aria-label="anchor" href="#ground-truth-meta_json-files"></a></h3>
<p>All metadata is stored in JSON files following the emuR convention:</p>
<ul><li>Database level: Stored in <code>&lt;dbname&gt;_DBconfig.json</code> under <code>metadataDefaults</code>
</li>
<li>Session level: <code>&lt;session&gt;_ses/&lt;session&gt;.meta_json</code>
</li>
<li>Bundle level: <code>&lt;session&gt;_ses/&lt;bundle&gt;_bndl/&lt;bundle&gt;.meta_json</code>
</li>
</ul></div>
<div class="section level3">
<h3 id="sqlite-cache">SQLite Cache<a class="anchor" aria-label="anchor" href="#sqlite-cache"></a></h3>
<p>For performance, metadata is cached in the <code>_emuDBcache.sqlite</code> file with these tables:</p>
<ul><li>
<code>metadata_fields</code>: Tracks all known metadata field names and types</li>
<li>
<code>metadata_database</code>: Database-level default values</li>
<li>
<code>metadata_session</code>: Session-level default values<br></li>
<li>
<code>metadata_bundle</code>: Bundle-specific values</li>
</ul><p>The cache is automatically rebuilt when: - <code><a href="reference/build_emuDB_cache.html">build_emuDB_cache()</a></code> is called - <code><a href="reference/gather_metadata.html">gather_metadata()</a></code> is explicitly invoked - Metadata is imported from Excel</p>
</div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h2>
<div class="section level3">
<h3 id="basic-operations">Basic Operations<a class="anchor" aria-label="anchor" href="#basic-operations"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">reindeer</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load corpus</span></span>
<span><span class="va">ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/corpus.html">corpus</a></span><span class="op">(</span><span class="st">"path/to/ae_emuDB"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gather metadata from .meta_json files</span></span>
<span><span class="fu"><a href="reference/gather_metadata.html">gather_metadata</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get all metadata with inheritance resolved</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="setting-metadata-programmatically">Setting Metadata Programmatically<a class="anchor" aria-label="anchor" href="#setting-metadata-programmatically"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Database-wide defaults</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Project <span class="op">=</span> <span class="st">"Speech Study"</span>, Year <span class="op">=</span> <span class="fl">2024</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Session-level metadata</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Speaker <span class="op">=</span> <span class="st">"P001"</span>, Dialect <span class="op">=</span> <span class="st">"Northern"</span><span class="op">)</span>, </span>
<span>            session <span class="op">=</span> <span class="st">"Session1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bundle-specific metadata</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">25</span>, Sex <span class="op">=</span> <span class="st">"Male"</span><span class="op">)</span>, </span>
<span>            session <span class="op">=</span> <span class="st">"Session1"</span>, bundle <span class="op">=</span> <span class="st">"Bundle1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Alternative syntax using bracket notation</span></span>
<span><span class="va">ae</span><span class="op">[</span><span class="st">"Session1"</span>, <span class="st">"Bundle1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">26</span>, Quality <span class="op">=</span> <span class="st">"Good"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="type-validation">Type Validation<a class="anchor" aria-label="anchor" href="#type-validation"></a></h3>
<p>The system tracks field types and validates new assignments:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First assignment establishes the type</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, session <span class="op">=</span> <span class="st">"S1"</span>, bundle <span class="op">=</span> <span class="st">"B1"</span><span class="op">)</span>  <span class="co"># numeric</span></span>
<span></span>
<span><span class="co"># This will fail (type mismatch)</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="st">"twenty-five"</span><span class="op">)</span>, session <span class="op">=</span> <span class="st">"S1"</span>, bundle <span class="op">=</span> <span class="st">"B1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># New fields require confirmation in interactive mode</span></span>
<span><span class="va">ae</span><span class="op">[</span><span class="st">"S1"</span>, <span class="st">"B1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>NewField <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span><span class="co"># &gt; Field 'NewField' is new. Add it as type 'character'? (y/n):</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="excel-importexport">Excel Import/Export<a class="anchor" aria-label="anchor" href="#excel-importexport"></a></h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Export to Excel for batch editing</span></span>
<span><span class="fu"><a href="reference/export_metadata.html">export_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="st">"metadata.xlsx"</span>, mandatory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Age"</span>, <span class="st">"Gender"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Edit in Excel, then re-import</span></span>
<span><span class="fu"><a href="reference/import_metadata.html">import_metadata</a></span><span class="op">(</span><span class="va">ae</span>, <span class="st">"metadata.xlsx"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cache is automatically updated</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="enhanced-summary">Enhanced Summary<a class="anchor" aria-label="anchor" href="#enhanced-summary"></a></h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get comprehensive database summary including metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Output includes:</span></span>
<span><span class="co"># - Basic statistics (sessions, bundles, items, labels, links)</span></span>
<span><span class="co"># - Level definitions</span></span>
<span><span class="co"># - Link definitions  </span></span>
<span><span class="co"># - SSFF track definitions</span></span>
<span><span class="co"># - Metadata diagnostics (fields, types, coverage)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="metadata-diagnostics">Metadata Diagnostics<a class="anchor" aria-label="anchor" href="#metadata-diagnostics"></a></h3>
<p>The summary includes diagnostics showing:</p>
<pre><code>─ Metadata summary ─────────────────────────────────────────────
Field      Type       Level    Bundles  Sessions  Database
Age        numeric    bundle   15       0         0
Gender     character  session  0        3         0
Project    character  database 0        0         1</code></pre>
<p>This helps identify: - Misspelled field names (e.g., “Gendar” vs “Gender”) - Inconsistent types - Coverage patterns</p>
</div>
<div class="section level3">
<h3 id="integration-with-queries">Integration with Queries<a class="anchor" aria-label="anchor" href="#integration-with-queries"></a></h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add metadata to query results</span></span>
<span><span class="va">segments</span> <span class="op">&lt;-</span> <span class="fu">query_opt</span><span class="op">(</span><span class="va">ae</span>, <span class="st">"Phonetic=n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Enrich with metadata</span></span>
<span><span class="va">segments_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/biographize.html">biographize</a></span><span class="op">(</span><span class="va">segments</span>, <span class="va">ae</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now includes all metadata fields</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">segments_meta</span><span class="op">)</span></span>
<span><span class="co"># [1] "session" "bundle" "start" "end" "label" "Age" "Gender" "Project"...</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="implementation-details">Implementation Details<a class="anchor" aria-label="anchor" href="#implementation-details"></a></h2>
<div class="section level3">
<h3 id="efficiency-optimizations">Efficiency Optimizations<a class="anchor" aria-label="anchor" href="#efficiency-optimizations"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Batch operations</strong>: All file I/O uses transactions</li>
<li>
<strong>Prepared statements</strong>: SQL queries are parameterized</li>
<li>
<strong>Lazy loading</strong>: Metadata is only loaded when needed</li>
<li>
<strong>Connection pooling</strong>: Database connections are reused</li>
<li>
<strong>Indexed queries</strong>: Foreign key and field name indices</li>
</ol></div>
<div class="section level3">
<h3 id="field-type-system">Field Type System<a class="anchor" aria-label="anchor" href="#field-type-system"></a></h3>
<p>Supported types with automatic serialization:</p>
<ul><li>
<code>character</code>: Text values</li>
<li>
<code>numeric</code>: Decimal numbers</li>
<li>
<code>integer</code>: Whole numbers</li>
<li>
<code>logical</code>: TRUE/FALSE values</li>
<li>
<code>date</code>: Date objects (ISO 8601)</li>
<li>
<code>datetime</code>: POSIXct timestamps (ISO 8601)</li>
</ul></div>
<div class="section level3">
<h3 id="inheritance-resolution">Inheritance Resolution<a class="anchor" aria-label="anchor" href="#inheritance-resolution"></a></h3>
<p>When retrieving metadata, the system:</p>
<ol style="list-style-type: decimal"><li>Checks bundle-level metadata first</li>
<li>Falls back to session-level if not found</li>
<li>Finally uses database-level defaults</li>
<li>Returns NA if not defined anywhere</li>
</ol><p>This is efficiently implemented with LEFT JOIN queries.</p>
</div>
<div class="section level3">
<h3 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h3>
<p>The system provides clear error messages for:</p>
<ul><li>Missing .meta_json files (warns, continues)</li>
<li>Type mismatches (errors with conversion suggestion)</li>
<li>Invalid metadata structure (errors with details)</li>
<li>Unknown fields in non-interactive mode (errors)</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="migration-from-old-system">Migration from Old System<a class="anchor" aria-label="anchor" href="#migration-from-old-system"></a></h2>
<p>If using the old <code>reindeeR_metadata.R</code> functions:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Old way</span></span>
<span><span class="va">old_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="va">emuDBhandle</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># New way (after converting to corpus)</span></span>
<span><span class="va">ae</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/corpus.html">corpus</a></span><span class="op">(</span><span class="va">emuDBhandle</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/gather_metadata.html">gather_metadata</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span></span>
<span><span class="va">new_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Results are equivalent, but new system is much faster</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="performance-benchmarks">Performance Benchmarks<a class="anchor" aria-label="anchor" href="#performance-benchmarks"></a></h2>
<p>On a database with 1000 bundles:</p>
<table class="table"><thead><tr><th>Operation</th>
<th>Old System</th>
<th>New System</th>
<th>Speedup</th>
</tr></thead><tbody><tr><td>gather_metadata</td>
<td>45s</td>
<td>2.1s</td>
<td>21x</td>
</tr><tr><td>get_metadata</td>
<td>12s</td>
<td>0.08s</td>
<td>150x</td>
</tr><tr><td>add_metadata (single)</td>
<td>0.5s</td>
<td>0.02s</td>
<td>25x</td>
</tr><tr><td>export_metadata</td>
<td>15s</td>
<td>1.2s</td>
<td>12x</td>
</tr></tbody></table></div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a></h2>
<ol style="list-style-type: decimal"><li><strong>Call <code><a href="reference/gather_metadata.html">gather_metadata()</a></code> after manual .meta_json edits</strong></li>
<li><strong>Use Excel export/import for batch corrections</strong></li>
<li><strong>Set database defaults for common fields</strong></li>
<li><strong>Use session-level metadata for speaker properties</strong></li>
<li><strong>Reserve bundle-level for recording-specific data</strong></li>
<li><strong>Run <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> periodically to check for inconsistencies</strong></li>
<li><strong>Always validate type compatibility before imports</strong></li>
</ol></div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a></h2>
<div class="section level3">
<h3 id="cache-out-of-sync">Cache out of sync<a class="anchor" aria-label="anchor" href="#cache-out-of-sync"></a></h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rebuild cache from .meta_json files</span></span>
<span><span class="fu"><a href="reference/gather_metadata.html">gather_metadata</a></span><span class="op">(</span><span class="va">ae</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="unknown-fields">Unknown fields<a class="anchor" aria-label="anchor" href="#unknown-fields"></a></h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check what fields are currently known</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_connection.html">get_connection</a></span><span class="op">(</span><span class="va">ae</span><span class="op">)</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM metadata_fields"</span><span class="op">)</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="excel-import-fails">Excel import fails<a class="anchor" aria-label="anchor" href="#excel-import-fails"></a></h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Verify Excel structure</span></span>
<span><span class="va">meta_df</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="st">"metadata.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"bundles"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">meta_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check for required columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"session"</span>, <span class="st">"bundle"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">meta_df</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="api-reference">API Reference<a class="anchor" aria-label="anchor" href="#api-reference"></a></h2>
<div class="section level3">
<h3 id="core-functions">Core Functions<a class="anchor" aria-label="anchor" href="#core-functions"></a></h3>
<ul><li>
<code>gather_metadata(corpus_obj, verbose = TRUE)</code>: Scan and cache all metadata</li>
<li>
<code>get_metadata(corpus_obj, session_pattern = ".*", bundle_pattern = ".*")</code>: Retrieve metadata</li>
<li>
<code>add_metadata(corpus_obj, metadataList, session = NULL, bundle = NULL, reset.before.add = FALSE)</code>: Set metadata</li>
<li>
<code>export_metadata(corpus_obj, Excelfile, overwrite = FALSE, mandatory = c())</code>: Export to Excel</li>
<li>
<code>import_metadata(corpus_obj, Excelfile)</code>: Import from Excel</li>
<li>
<code>biographize(segs_tbl, corpus_obj, compute_digests = FALSE, algorithm = "sha1")</code>: Add metadata to segments</li>
<li>
<code>summary.corpus(object, ...)</code>: Enhanced summary with metadata diagnostics</li>
</ul></div>
<div class="section level3">
<h3 id="internal-functions">Internal Functions<a class="anchor" aria-label="anchor" href="#internal-functions"></a></h3>
<ul><li>
<code>initialize_metadata_schema(con)</code>: Create SQLite tables</li>
<li>
<code>process_metadata_list(con, db_uuid, session, bundle, meta_list, level)</code>: Cache metadata</li>
<li>
<code>serialize_metadata_value(value)</code>: Convert R to SQLite</li>
<li>
<code>deserialize_metadata_value(value_str, type_str)</code>: Convert SQLite to R</li>
<li>
<code>get_metadata_diagnostics(con, db_uuid)</code>: Generate diagnostic summary</li>
<li>
<code>set_metadata_validated(corpus_obj, meta_list, session, bundle, level)</code>: Validate before setting</li>
<li>
<code>write_metadata_to_json(corpus_obj, meta_list, session, bundle, level)</code>: Update .meta_json files</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="future-enhancements">Future Enhancements<a class="anchor" aria-label="anchor" href="#future-enhancements"></a></h2>
<p>Possible additions:</p>
<ol style="list-style-type: decimal"><li>
<strong>Metadata schemas</strong>: Define required fields and validation rules</li>
<li>
<strong>Version tracking</strong>: Track metadata changes over time</li>
<li>
<strong>Bulk operations</strong>: Parallel metadata updates</li>
<li>
<strong>Search</strong>: Full-text search across metadata</li>
<li>
<strong>Validation rules</strong>: Complex constraints (e.g., Age &gt; 0)</li>
<li>
<strong>Import from CSV</strong>: Alternative to Excel</li>
<li>
<strong>Metadata inheritance visualization</strong>: Show where each value comes from</li>
</ol></div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a></h2>
<p>Part of the reindeer package. See package LICENSE file for details.</p>
</div>
<div class="section level2">
<h2 id="contact">Contact<a class="anchor" aria-label="anchor" href="#contact"></a></h2>
<p>For issues or questions about the metadata system, please file an issue on the reindeer GitHub repository.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/frkkan96" class="external-link">Fredrik Karlsson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


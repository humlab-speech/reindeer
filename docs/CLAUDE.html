<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • reindeer</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">reindeer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.17</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="index.html"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/Tidy_speech_processing.html">Tidy Speech Processing</a></li>
    <li><a class="dropdown-item" href="articles/metadata_management.html">Metadata Management</a></li>
    <li><a class="dropdown-item" href="articles/transcription_workflow.html">Transcription Workflow</a></li>
    <li><a class="dropdown-item" href="articles/simulation-infrastructure.html">Simulation Infrastructure</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/humlab-speech/reindeer"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CLAUDE.md</h1>

    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="package-overview">Package Overview<a class="anchor" aria-label="anchor" href="#package-overview"></a></h2>
<p><strong>reindeer</strong> is an R package that extends <a href="https://github.com/IPS-LMU/emuR" class="external-link">emuR</a> for working with speech data in a nordic climate. It provides optimized workflows for:</p>
<ul><li>Metadata management with SQLite caching</li>
<li>Speech signal processing with age/gender-appropriate parameters</li>
<li>Annotation and transcription systems</li>
<li>Query optimization using direct SQLite access</li>
<li>Track data quantification and enrichment</li>
</ul><p>The package uses modern S7 classes and data.table for performance, with extensive caching to handle computationally intensive operations on large speech corpora.</p>
</div>
<div class="section level2">
<h2 id="development-commands">Development Commands<a class="anchor" aria-label="anchor" href="#development-commands"></a></h2>
<div class="section level3">
<h3 id="building-and-testing">Building and Testing<a class="anchor" aria-label="anchor" href="#building-and-testing"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Install package with dependencies</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::install(dependencies = TRUE)"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Load for development</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::load_all()"</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># Run all tests</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::test()"</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Run specific test file</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test_query_optimized.R')"</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># Check package (R CMD check)</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::check()"</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co"># Build documentation</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::document()"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="benchmarking">Benchmarking<a class="anchor" aria-label="anchor" href="#benchmarking"></a></h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Run benchmarks from benchmarking/ directory</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">Rscript</span> benchmarking/benchmark_dspp.R</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">Rscript</span> benchmarking/benchmark_serialization.R</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co"># Verify implementation correctness</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="ex">Rscript</span> verify_implementation.R</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="building-vignettes">Building Vignettes<a class="anchor" aria-label="anchor" href="#building-vignettes"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Render a specific vignette</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">Rscript</span> render_vignette.R</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Build all vignettes</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::build_vignettes()"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="architecture-overview">Architecture Overview<a class="anchor" aria-label="anchor" href="#architecture-overview"></a></h2>
<div class="section level3">
<h3 id="core-s7-classes">Core S7 Classes<a class="anchor" aria-label="anchor" href="#core-s7-classes"></a></h3>
<p>The package uses S7 object system for type safety and performance:</p>
<ul><li>
<p><strong><code>corpus</code></strong> (<code>R/reindeer-corpus.R</code>): Main class representing an Emu database with persistent SQLite connection</p>
<ul><li>Properties: <code>dbName</code>, <code>basePath</code>, <code>config</code>, <code>.uuid</code>, <code>.connection</code>
</li>
<li>Constructor handles both paths and emuDBhandle objects</li>
<li>Automatically builds/updates SQLite cache on creation</li>
<li>Supports bracket notation for metadata access: <code>corpus["Session","Bundle"]</code>
</li>
</ul></li>
<li>
<p><strong><code>segment_list</code></strong> (<code>R/reindeer_segment_list.R</code>): Query results containing time-aligned segments</p>
<ul><li>Subclass of tibble with required columns: session, bundle, start, end, label</li>
<li>Created by <code><a href="reference/ask_for.html">ask_for()</a></code> and <code><a href="https://rdrr.io/pkg/reindeer/man/query.html" class="external-link">query()</a></code> functions</li>
</ul></li>
<li><p><strong><code>extended_segment_list</code></strong>: segment_list enriched with metadata and/or signal tracks</p></li>
<li>
<p><strong><code>lazy_segment_list</code></strong> (<code>R/reindeer_lazy_segment_list.R</code>): Delayed evaluation wrapper</p>
<ul><li>Not yet fully integrated into main workflow</li>
<li>Future optimization for query chains</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="data-flow-architecture">Data Flow Architecture<a class="anchor" aria-label="anchor" href="#data-flow-architecture"></a></h3>
<pre><code>User Query (EQL)
    ↓
ask_for() / query() [R/reindeer_query_optimized.r]
    ↓
SQLite Cache (_emuDBcache.sqlite) ← built by build_emuDB_cache()
    ↓
segment_list (S7 object)
    ↓
quantify() / enrich() [R/reindeeR_signalextensions_dt.R]
    ↓
Signal Processing + Persistent Cache
    ↓
extended_segment_list with tracks/metadata</code></pre>
</div>
<div class="section level3">
<h3 id="metadata-system">Metadata System<a class="anchor" aria-label="anchor" href="#metadata-system"></a></h3>
<p>Three-level hierarchy with proper inheritance (R/reindeeR_metadata_optimized.R):</p>
<ol style="list-style-type: decimal"><li>
<strong>Database level</strong>: Defaults for all bundles (stored in <code>&lt;dbname&gt;_DBconfig.json</code>)</li>
<li>
<strong>Session level</strong>: Overrides for session (stored in <code>&lt;session&gt;.meta_json</code>)</li>
<li>
<strong>Bundle level</strong>: Bundle-specific values (stored in <code>&lt;bundle&gt;.meta_json</code>)</li>
</ol><p>Key functions: - <code>gather_metadata(corpus)</code>: Scan .meta_json files and populate SQLite cache - <code>get_metadata(corpus)</code>: Retrieve with inheritance resolved - <code>add_metadata(corpus, list(...), session, bundle)</code>: Set metadata programmatically - <code>export_metadata(corpus, "file.xlsx")</code> / <code>import_metadata(corpus, "file.xlsx")</code>: Batch editing - <code>biographize(segments, corpus)</code>: Enrich query results with metadata</p>
<p><strong>Ground truth</strong>: Always the <code>.meta_json</code> files. SQLite cache is for performance only.</p>
</div>
<div class="section level3">
<h3 id="query-system">Query System<a class="anchor" aria-label="anchor" href="#query-system"></a></h3>
<p>Two implementations: 1. <strong>Standard emuR</strong>: Via <code><a href="https://rdrr.io/pkg/emuR/man/query.html" class="external-link">emuR::query()</a></code> (slower, more compatible) 2. <strong>Optimized</strong>: Via <code><a href="reference/ask_for.html">ask_for()</a></code> / <code><a href="https://rdrr.io/pkg/reindeer/man/query.html" class="external-link">query()</a></code> - direct SQLite queries (<code>R/reindeer_query_optimized.r</code>)</p>
<p>The optimized system: - Parses EQL (EMU Query Language) directly - Queries <code>_emuDBcache.sqlite</code> without emuR overhead - Supports: ==, !=, =~, !~, sequences [A -&gt; B], dominance [A ^ B], projection #Level - Returns segment_list objects</p>
<p>Example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/corpus.html">corpus</a></span><span class="op">(</span><span class="st">"path/to/db_emuDB"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">corp</span></span>
<span><span class="fu"><a href="reference/ask_for.html">ask_for</a></span><span class="op">(</span><span class="va">corp</span>, <span class="st">"Phonetic == t"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">segments</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="signal-processing--caching">Signal Processing &amp; Caching<a class="anchor" aria-label="anchor" href="#signal-processing--caching"></a></h3>
<p><strong>Age/Gender-Specific Parameters</strong> (<code>R/reindeeR_signalextensions_dt.R</code>): - <code><a href="reference/dspp_metadataParameters_dt.html">dspp_metadataParameters_dt()</a></code>: Returns processing params based on Age/Gender - Uses LOESS smoothing over empirical defaults from literature - Optimized with data.table (3-4x faster than original dplyr version)</p>
<p><strong>Track Quantification</strong>: - <code>quantify(segments, corpus, tracks, ...)</code>: Extract signal measurements - Uses persistent cache in SQLite to avoid recomputation - Cache serialization currently uses base R <code><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize()</a></code> - <strong>Optimization available</strong>: qs package provides 3-4x speedup (see SERIALIZATION_QUICK_REF.md)</p>
<p><strong>Cache Management</strong> (<code>R/cache_utils.R</code>): - <code>.set_persistent_cache()</code> / <code>.get_persistent_cache()</code>: Internal cache functions - Cache invalidation based on signal file modification time + processing parameters - Uses digest/hash to identify unique parameter combinations</p>
</div>
<div class="section level3">
<h3 id="python-integration">Python Integration<a class="anchor" aria-label="anchor" href="#python-integration"></a></h3>
<p>The package uses Python (via reticulate) for some annotation tasks:</p>
<ul><li>
<strong>MOMEL/INTSINT</strong> (<code>R/reindeer_annotate_momel.R</code>, <code>R/reindeeR_annotate_python.R</code>):
<ul><li>Pitch stylization and tonal annotation</li>
<li>Uses Parselmouth (Python Praat wrapper)</li>
<li>
<code><a href="reference/draft_intsint_momel.html">draft_intsint_momel()</a></code>: Main implementation</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="c-components">C++ Components<a class="anchor" aria-label="anchor" href="#c-components"></a></h3>
<p>Two C++ files in <code>src/</code>: - <code>corpus_config_helpers.cpp</code>: Fast database configuration operations - <code>RcppExports.cpp</code>: Auto-generated Rcpp bindings</p>
<p>Functions are called from <code>R/RcppExports.R</code> and used in corpus configuration utilities.</p>
</div>
</div>
<div class="section level2">
<h2 id="key-design-patterns">Key Design Patterns<a class="anchor" aria-label="anchor" href="#key-design-patterns"></a></h2>
<div class="section level3">
<h3 id="id_1-ground-truth-vs-cache">1. Ground Truth vs Cache<a class="anchor" aria-label="anchor" href="#id_1-ground-truth-vs-cache"></a></h3>
<ul><li>
<strong>Ground truth</strong>: JSON files (<code>.meta_json</code>, <code>_DBconfig.json</code>, <code>_annot.json</code>)</li>
<li>
<strong>Cache</strong>: SQLite database (<code>_emuDBcache.sqlite</code>)</li>
<li>Always trust JSON files; rebuild cache when in doubt: <code>gather_metadata(corpus)</code>
</li>
</ul></div>
<div class="section level3">
<h3 id="id_2-optimized-vs-legacy">2. Optimized vs Legacy<a class="anchor" aria-label="anchor" href="#id_2-optimized-vs-legacy"></a></h3>
<p>Many functions have optimized versions: - <code>reindeeR_metadata_optimized.R</code> vs <code>reindeeR_metadata.R</code> (deprecated) - <code>reindeer_query_optimized.r</code> (<code>ask_for</code>) vs <code><a href="https://rdrr.io/pkg/emuR/man/query.html" class="external-link">emuR::query()</a></code> - <code>reindeeR_signalextensions_dt.R</code> (data.table) vs <code>reindeeR_signalextensions.R</code> (dplyr, deprecated) - <code>reindeer_transcription_system_optimized.R</code> vs <code>reindeer_transcription_system.R</code> (deprecated)</p>
<p>See DEPRECATED_FUNCTIONS.md for complete list of files marked for deletion.</p>
</div>
<div class="section level3">
<h3 id="id_3-lazy-evaluation-future">3. Lazy Evaluation (Future)<a class="anchor" aria-label="anchor" href="#id_3-lazy-evaluation-future"></a></h3>
<p><code>R/reindeer_lazy_segment_list.R</code> implements lazy evaluation for query chains but is not yet integrated into main workflow. This is a planned optimization.</p>
</div>
<div class="section level3">
<h3 id="id_4-simulation-system">4. Simulation System<a class="anchor" aria-label="anchor" href="#id_4-simulation-system"></a></h3>
<p><code>R/reindeer_simulation.R</code> provides infrastructure for systematic parameter space exploration: - <strong><code><a href="reference/quantify_simulate.html">quantify_simulate()</a></code></strong>: Run DSP analysis with parameter grids on segments - <strong><code><a href="reference/enrich_simulate.html">enrich_simulate()</a></code></strong>: Generate tracks with parameter grids across corpus - <strong>Preprocessing support</strong>: Apply transformations to media before DSP (NEW!) - <code>.prep_function</code>: Function to transform media (e.g., <code>superassp::prep_recode</code>) - <code>.prep_simulate</code>: Parameter grid for preprocessing (e.g., sample rates, codecs) - Full outer product of DSP × prep parameters - <strong>Caching</strong>: Results stored in SQLite for retrieval and analysis - <code><a href="reference/list_simulations.html">list_simulations()</a></code>: Show available simulation caches - <code><a href="reference/reminisce.html">reminisce()</a></code> / <code><a href="reference/reminisce_tracks.html">reminisce_tracks()</a></code>: Retrieve cached simulation results</p>
<p><strong>Example with preprocessing</strong>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate formant analysis with different sample rates</span></span>
<span><span class="fu"><a href="reference/quantify_simulate.html">quantify_simulate</a></span><span class="op">(</span></span>
<span>  <span class="va">segments</span>,</span>
<span>  .using <span class="op">=</span> <span class="fu">superassp</span><span class="fu">::</span><span class="va"><a href="https://humlab-speech.github.io/superassp/reference/forest.html" class="external-link">forest</a></span>,</span>
<span>  .simulate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nominalF1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">900</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># DSP params</span></span>
<span>  .prep_function <span class="op">=</span> <span class="fu">superassp</span><span class="fu">::</span><span class="va">prep_recode</span>,</span>
<span>  .prep_simulate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sample_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16000</span>, <span class="fl">22050</span>, <span class="fl">44100</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># Prep params</span></span>
<span>  .simulation_store <span class="op">=</span> <span class="st">"simulations/formants"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Creates 3 sample rates × 5 nominalF1 = 15 combinations per segment</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h2>
<p>Test files in <code>tests/testthat/</code>: - <code>test_query_optimized.R</code>: Query system tests - <code>test_metadata_optimized.R</code>: Metadata system tests - <code>test_quantify_segment_list.R</code>: Signal quantification tests - <code>test-annotation-fidelity.R</code>: Annotation accuracy tests - <code>test_reindeeR-metadata.R</code>: Legacy metadata tests</p>
<p>Tests use the <code>ae</code> demo database from emuR package.</p>
</div>
<div class="section level2">
<h2 id="important-conventions">Important Conventions<a class="anchor" aria-label="anchor" href="#important-conventions"></a></h2>
<div class="section level3">
<h3 id="function-naming">Function Naming<a class="anchor" aria-label="anchor" href="#function-naming"></a></h3>
<ul><li>
<code><a href="reference/ask_for.html">ask_for()</a></code> / <code><a href="https://rdrr.io/pkg/reindeer/man/query.html" class="external-link">query()</a></code>: Query the database (returns segment_list)</li>
<li>
<code><a href="reference/quantify.html">quantify()</a></code>: Extract measurements from signal tracks</li>
<li>
<code><a href="reference/enrich.html">enrich()</a></code>: Add signal data to segments</li>
<li>
<code><a href="reference/biographize.html">biographize()</a></code>: Add metadata to segments</li>
<li>
<code>gather_*()</code>: Collect data from JSON files into cache</li>
<li>
<code>get_*()</code>: Retrieve data (usually from cache)</li>
<li>
<code>add_*()</code>: Set/update data (writes to JSON + updates cache)</li>
</ul></div>
<div class="section level3">
<h3 id="file-naming">File Naming<a class="anchor" aria-label="anchor" href="#file-naming"></a></h3>
<ul><li>
<code>reindeeR_*.R</code>: Core reindeer functionality</li>
<li>
<code>reindeer_*.R</code>: Extended/specialized functionality</li>
<li>
<code>*_optimized.R</code>: Performance-optimized implementations</li>
<li>
<code>*_dt.R</code>: data.table-based implementations</li>
<li>
<code>emuR_*.R</code>: Extensions/wrappers for emuR functions</li>
</ul></div>
<div class="section level3">
<h3 id="object-properties">Object Properties<a class="anchor" aria-label="anchor" href="#object-properties"></a></h3>
<ul><li>Use <code>@</code> for S7 property access: <code>corpus@basePath</code>
</li>
<li>Use <code>$</code> for emuDBhandle attributes: <code>handle$basePath</code>
</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a></h2>
<div class="section level3">
<h3 id="current-optimizations">Current Optimizations<a class="anchor" aria-label="anchor" href="#current-optimizations"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>SQLite caching</strong>: Metadata, query results, signal processing cache</li>
<li>
<strong>data.table</strong>: Used for large data operations (3-5x speedup vs dplyr)</li>
<li>
<strong>Persistent cache</strong>: Avoid recomputing identical signal processing operations</li>
<li>
<strong>Lazy evaluation</strong>: Prepared but not yet fully integrated</li>
</ol></div>
<div class="section level3">
<h3 id="known-optimization-opportunities">Known Optimization Opportunities<a class="anchor" aria-label="anchor" href="#known-optimization-opportunities"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Cache serialization</strong>: Switch from <code><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize()</a></code> to <code>qs</code> package (3-4x faster, see SERIALIZATION_QUICK_REF.md)</li>
<li>
<strong>Lazy segment_list</strong>: Integrate <code>lazy_segment_list</code> into <code><a href="reference/ask_for.html">ask_for()</a></code> workflow</li>
<li>
<strong>Parallel processing</strong>: <code><a href="reference/transcribe_parallel.html">transcribe_parallel()</a></code> exists but not widely used</li>
</ol></div>
</div>
<div class="section level2">
<h2 id="common-development-tasks">Common Development Tasks<a class="anchor" aria-label="anchor" href="#common-development-tasks"></a></h2>
<div class="section level3">
<h3 id="adding-a-new-signal-track">Adding a new signal track<a class="anchor" aria-label="anchor" href="#adding-a-new-signal-track"></a></h3>
<ol style="list-style-type: decimal"><li>Define track in database config: <code><a href="https://rdrr.io/pkg/reindeer/man/add_ssffTrackDefinition.html" class="external-link">add_ssffTrackDefinition()</a></code>
</li>
<li>Compute track: Use <code>superassp</code> or custom DSP function</li>
<li>Add track to corpus: Store SSFF files in bundle directories</li>
<li>Access in queries: <code>quantify(segments, corp, tracks = "newtrack")</code>
</li>
</ol></div>
<div class="section level3">
<h3 id="adding-metadata-fields">Adding metadata fields<a class="anchor" aria-label="anchor" href="#adding-metadata-fields"></a></h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set database-wide default</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">corp</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Project <span class="op">=</span> <span class="st">"MyStudy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set session-level</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">corp</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Speaker <span class="op">=</span> <span class="st">"P01"</span><span class="op">)</span>, session <span class="op">=</span> <span class="st">"Session1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set bundle-level</span></span>
<span><span class="fu"><a href="reference/add_metadata.html">add_metadata</a></span><span class="op">(</span><span class="va">corp</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Quality <span class="op">=</span> <span class="st">"Good"</span><span class="op">)</span>, session <span class="op">=</span> <span class="st">"Session1"</span>, bundle <span class="op">=</span> <span class="st">"Bundle1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Always call gather_metadata() after manual .meta_json edits</span></span>
<span><span class="fu"><a href="reference/gather_metadata.html">gather_metadata</a></span><span class="op">(</span><span class="va">corp</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="debugging-cache-issues">Debugging cache issues<a class="anchor" aria-label="anchor" href="#debugging-cache-issues"></a></h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rebuild metadata cache</span></span>
<span><span class="fu"><a href="reference/gather_metadata.html">gather_metadata</a></span><span class="op">(</span><span class="va">corp</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check cache contents</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_connection.html">get_connection</a></span><span class="op">(</span><span class="va">corp</span><span class="op">)</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM metadata_fields"</span><span class="op">)</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clear all caches</span></span>
<span><span class="fu">clear_all_caches</span><span class="op">(</span><span class="va">corp</span><span class="op">)</span>  <span class="co"># if defined in corpus_config.R</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-specific-benchmarks">Running specific benchmarks<a class="anchor" aria-label="anchor" href="#running-specific-benchmarks"></a></h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Compare implementations</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">Rscript</span> benchmarking/benchmark_dspp.R</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># Test serialization methods</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="ex">Rscript</span> benchmarking/benchmark_serialization.R</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="documentation-files">Documentation Files<a class="anchor" aria-label="anchor" href="#documentation-files"></a></h2>
<p>The repository contains extensive markdown documentation (these are implementation notes, not user-facing docs):</p>
<ul><li>
<strong>METADATA_SYSTEM.md</strong>: Detailed metadata architecture</li>
<li>
<strong>SERIALIZATION_QUICK_REF.md</strong>: Cache optimization guide</li>
<li>
<strong>DEPRECATED_FUNCTIONS.md</strong>: Files/functions marked for deletion</li>
<li>
<strong>CACHE_OPTIMIZATION_SUMMARY.md</strong>: Cache implementation details</li>
<li>Multiple <code>*_IMPLEMENTATION_SUMMARY.md</code> files documenting major features</li>
</ul><p>These are developer notes, not user documentation. User docs are in: - <code>vignettes/*.Rmd</code>: User-facing tutorials - <code>man/*.Rd</code>: Function reference (auto-generated by roxygen2)</p>
</div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h2>
<p>Key dependencies: - <strong>emuR</strong> (&gt;= 2.0.2): Base EMU-SDMS functionality - <strong>S7</strong>: Modern OOP system - <strong>data.table</strong> (&gt;= 1.14.0): High-performance data manipulation - <strong>reticulate</strong>: Python integration (for Parselmouth/MOMEL) - <strong>superassp</strong>: Advanced signal processing (from GitHub: humlab-speech/superassp) - <strong>qs</strong> (&gt;= 0.25.0): Fast serialization (in Imports as of recent optimization) - <strong>DBI, RSQLite</strong>: SQLite database access - <strong>digest</strong>: Hash computation for cache keys</p>
</div>
<div class="section level2">
<h2 id="working-with-git">Working with Git<a class="anchor" aria-label="anchor" href="#working-with-git"></a></h2>
<p>Current branch: <code>S7speedy</code> (feature branch for S7 optimization) Main branch: <code>main</code></p>
<p>Recent focus areas (based on commit history): - Cache serialization optimization (qs package) - Deprecating legacy code - Workflow documentation - Performance benchmarking</p>
<p>When committing, follow existing commit message style: - <code>feat:</code> for new features - <code>refactor:</code> for code restructuring - <code>fix:</code> for bug fixes - Be specific about the change and its impact</p>
</div>
<div class="section level2">
<h2 id="notes-for-claude-code">Notes for Claude Code<a class="anchor" aria-label="anchor" href="#notes-for-claude-code"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>Always prefer optimized versions</strong>: Use <code>*_optimized.R</code> and <code>*_dt.R</code> implementations</li>
<li>
<strong>Don’t edit deprecated files</strong>: See DEPRECATED_FUNCTIONS.md for files to avoid</li>
<li>
<strong>Maintain ground truth</strong>: Always update JSON files, not just SQLite cache</li>
<li>
<strong>Test with ae database</strong>: Use <code>reindeer:::create_ae_db()</code> for testing</li>
<li>
<strong>Check benchmarks</strong>: Run relevant benchmarks after performance-related changes</li>
<li>
<strong>Update docs</strong>: Roxygen comments for functions, vignettes for workflows</li>
<li>
<strong>S7 class properties</strong>: Use <code>@</code> not <code>$</code> for S7 objects</li>
<li>
<strong>Cache invalidation</strong>: Consider digest/hash when modifying cache-related code</li>
</ol></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/frkkan96" class="external-link">Fredrik Karlsson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

